<wdkModel>

  <paramSet name="clinicalVisitParams">
    
    <enumParam name="type"
               prompt="type"
               multiPick="false"
               quote="true"
               visible="false">
      <help>this is internal</help>
      <enumList>
        <enumValue default="true">
          <term>clinicalVisit</term>
          <internal>clinicalVisit</internal>
        </enumValue>
      </enumList>
    </enumParam>


    <!-- TEMPLATE_ANCHOR observationSourceIdParam -->

    <!-- TEMPLATE_ANCHOR observationFilterParams -->



       <dateRangeParam name="visit_date"
                       prompt="Choose start and end dates "
                       minDate="2011-07-01"
                       maxDate="2020-07-31">
         <help>"select the earliest and latest dates to include for identifying observations and computing mosquito counts."</help>

       </dateRangeParam>


    <numberRangeParam name="num_relative_events"
                       prompt="Number of matching related observations: "
                       integer="true"
                       min="1"
                       max="1000">
         <help>Set the range of the number of matching observations in order to keep or remove the observation from the previous step.</help>
         <suggest default="{'min': '1', 'max': '100'}" />  

       </numberRangeParam> 

    <numberRangeParam name="days_between"
                       prompt="Days between observations: "
                       integer="true"
                       min="0"
                       max="10000">
         <help>Set the range of days between observations to compare to observations selected in the previous step</help>
         <suggest default="{'min': '0', 'max': '10'}" />  

       </numberRangeParam> 

    <enumParam name="dateOperator"
               prompt="Keep or Remove observations "
               multiPick="false"
               quote="false"
               visible="true">
      <help>Choose how to compare these two observations.  Do you want to remove observations that have another observation within the specified time frame or keep them.</help>
      <enumList>
        <enumValue default="true">
          <term>remove</term>
          <internal>MINUS</internal>
        </enumValue>
        <enumValue>
          <term>keep</term>
          <internal>INTERSECT</internal>
        </enumValue>
      </enumList>
    </enumParam>

    <enumParam name="date_direction"
               prompt="Choose a direction "
               multiPick="false"
               quote="false"
               visible="true">
      <help>Choose a direction for the corresponding observation.  Will the matching observation be before or after relative to the first observation.</help>
      <enumList>
        <enumValue default="true">
          <term>after</term>
          <internal><![CDATA[>=]]></internal>
        </enumValue>
        <enumValue>
          <term>before</term>
          <internal><![CDATA[<=]]></internal>
        </enumValue>
      </enumList>
    </enumParam>

    <flatVocabParam name="use_relative_visits"
               prompt="Use related observations"
               multiPick="false"
               quote="false"
               visible="true"
               queryRef="ClinicalVisitVQ.useRelativeVisits">
      <help>You MUST change this parameter to Yes in order to use relative observations! If you decide to not use relative observations, set this parameter to No and make certain "Keep or remove observations" is set to remove.</help>
    </flatVocabParam>


    <flatVocabParam name="dateOperator_fv"
               prompt="Keep or Remove observations from previous step matching these criteria"
               multiPick="false"
               quote="false"
               visible="true"
               dependedParamRef="clinicalVisitParams.use_relative_visits"
               queryRef="ClinicalVisitVQ.dateOperator">
      <help>Choose how to compare these two observations.  Do you want to remove observations that have another observation within the specified time frame or keep them.</help>
    </flatVocabParam>

    <flatVocabParam name="date_direction_fv"
               prompt="Choose a direction "
               multiPick="false"
               quote="false"
               visible="true"
               queryRef="ClinicalVisitVQ.dateDirection">
      <help>Choose a direction for the corresponding observation.  Will the matching observation be before or after relative to the first observation.</help>
      <suggest default="before"/>
    </flatVocabParam>


    <!-- TEMPLATE_ANCHOR observationResultParam -->


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  MAL-ED specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <filterParam name="geographic_region_maled" 
                    metadataQueryRef="ClinicalVisitVQ.RegionMetaData_maled"
                    backgroundQueryRef="ClinicalVisitVQ.RegionMetaData_maled"
                    ontologyQueryRef="ParticipantVQ.RegionOntology_maled"
                    countPredictsAnswerCount="true"
                    prompt="Participant"
                    dependedParamRef="participantParams.tbl_prefix"
                    trimMetadataTerms="true">
      <help>
        Select observations based on the participants subcounty where they live. 
      </help>
    </filterParam>

    <filterParam name="households_maled" 
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_maled"
                    metadataQueryRef="ClinicalVisitVQ.HouseholdMetaData_maled"
                    backgroundQueryRef="ClinicalVisitVQ.HouseholdMetaDataBkgd_maled"
                    filterDataTypeDisplayName="Household Observations"
                    countPredictsAnswerCount="true"
                    prompt="Household Observations"
                    dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.geographic_region_maled"
                    trimMetadataTerms="true">
      <help>
        Select observations based on the characteristics of the household where the participants live. 
      </help>
    </filterParam>

       <filterParam name="participants_maled" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_maled"
                       metadataQueryRef="ClinicalVisitVQ.ParticipantMetaData_maled"
                       backgroundQueryRef="ClinicalVisitVQ.ParticipantMetaDataBkgd_maled"
                       countPredictsAnswerCount="true"
                       prompt="Participants"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.households_maled">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_maled" 
                    metadataQueryRef="ClinicalVisitVQ.VisitMetaData_maled"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_maled"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_maled"
                    countPredictsAnswerCount="true"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.participants_maled">
      <help>
        Select observations based on their observation characteristics. 
      </help>
    </filterParam>

    <filterParam name="relative_visits_maled" 
                    metadataQueryRef="ClinicalVisitVQ.RelVisitMetaData_maled"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_maled"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_maled"
                    countPredictsAnswerCount="false"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select related observations based on their characteristics. 
      </help>
    </filterParam>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  india ICEMR specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <filterParam name="geographic_region_india" 
                    metadataQueryRef="ClinicalVisitVQ.RegionMetaData_india"
                    backgroundQueryRef="ClinicalVisitVQ.RegionMetaData_india"
                    ontologyQueryRef="ParticipantVQ.RegionOntology_india"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="Households"
                    prompt="Geographic Region"
                    dependedParamRef="participantParams.tbl_prefix"
                    trimMetadataTerms="true">
      <help>
        Select observations based on geographic region where the participants live. 
      </help>
    </filterParam>


    <filterParam name="households_india" 
                       metadataQueryRef="ClinicalVisitVQ.HouseholdMetaData_india"
                       backgroundQueryRef="ClinicalVisitVQ.HouseholdMetaDataBkgd_india"
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_india"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Observations"
                       prompt="Households"
                       dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.geographic_region_india"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>


       <filterParam name="participants_india" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_india"
                       metadataQueryRef="ClinicalVisitVQ.ParticipantMetaData_india"
                       backgroundQueryRef="ClinicalVisitVQ.ParticipantMetaDataBkgd_india"
                       countPredictsAnswerCount="true"
                       prompt="Participants"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.households_india">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_india" 
                    metadataQueryRef="ClinicalVisitVQ.VisitMetaData_india"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_india"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_india"
                    countPredictsAnswerCount="true"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.participants_india">
      <help>
        Select observations based on their observation characteristics. 
      </help>
    </filterParam>

    <filterParam name="relative_visits_india" 
                    metadataQueryRef="ClinicalVisitVQ.RelVisitMetaData_india"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_india"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_india"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select related observations based on their characteristics. 
      </help>
    </filterParam>


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  Amazonia Peru ICEMR specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <filterParam name="geographic_region_amazperu" 
                    metadataQueryRef="ClinicalVisitVQ.RegionMetaData_amazperu"
                    backgroundQueryRef="ClinicalVisitVQ.RegionMetaData_amazperu"
                    ontologyQueryRef="ParticipantVQ.RegionOntology_amazperu"
                    countPredictsAnswerCount="true"
                    prompt="Participant"
                    dependedParamRef="participantParams.tbl_prefix"
                    trimMetadataTerms="true">
      <help>
        Select observations based on geographic region where the participants live. 
      </help>
    </filterParam>


    <filterParam name="households_amazperu" 
                       metadataQueryRef="ClinicalVisitVQ.HouseholdMetaData_amazperu"
                       backgroundQueryRef="ClinicalVisitVQ.HouseholdMetaDataBkgd_amazperu"
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_amazperu"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Households"
                       dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.geographic_region_amazperu"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>


       <filterParam name="participants_amazperu" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_amazperu"
                       metadataQueryRef="ClinicalVisitVQ.ParticipantMetaData_amazperu"
                       backgroundQueryRef="ClinicalVisitVQ.ParticipantMetaDataBkgd_amazperu"
                       countPredictsAnswerCount="true"
                       prompt="Participants"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.households_amazperu">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_amazperu" 
                    metadataQueryRef="ClinicalVisitVQ.VisitMetaData_amazperu"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_amazperu"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_amazperu"
                    countPredictsAnswerCount="true"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.participants_amazperu">
      <help>
        Select observations based on their observation characteristics. 
      </help>
    </filterParam>

    <filterParam name="relative_visits_amazperu" 
                    metadataQueryRef="ClinicalVisitVQ.RelVisitMetaData_amazperu"
                    backgroundQueryRef="ClinicalVisitVQ.RelVisitMetaData_amazperu"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_amazperu"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select related observations based on their characteristics. 
      </help>
    </filterParam>

  </paramSet>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  Vocab queries-->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

 <querySet name="ClinicalVisitVQ" queryType="vocab" isCacheable="true">

        <sqlQuery name="dateDirection">
            <column name="internal" />
            <column name="term" />
            <!-- `display` is the opposite of `term` because it is arranged in a sentence where the operands are the opposite of the query -->
            <sql>
              <![CDATA[
                       select * from (
                       SELECT  'after' as term, '>=' as internal from dual
                       UNION
                       SELECT  'before' as term, '<=' as internal from dual)
                       order by term desc
              ]]>
            </sql>
        </sqlQuery>

        <sqlQuery name="dateOperator">
          <paramRef ref="clinicalVisitParams.use_relative_visits" />  
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
            <![CDATA[
                     SELECT * from (
                     SELECT 'Remove' as display, 'remove' as term, 'MINUS' as internal from dual
                     UNION
                     SELECT 'Keep' as display, 'keep' as term, 'INTERSECT' as internal from dual
                     where $$use_relative_visits$$ = 1  )
                     ORDER by term desc
            ]]>
            </sql>
        </sqlQuery>


        <sqlQuery name="useRelativeVisits">
            <column name="internal" />
            <column name="term" />
            <sql>
            <![CDATA[
                     SELECT 'No' as term, 0 as internal from dual
                     UNION
                     SELECT 'Yes' as term, 1 as internal from dual
            ]]>
            </sql>
        </sqlQuery>

    <!-- TEMPLATE_ANCHOR observationFilterParamQueries -->


    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  MAL-ED specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="RegionMetaData_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select p.household_id as internal, ho.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD p, ApidbTuning.$$tbl_prefix$$HouseObsIO ho
where p.ontology_term_name in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and ho.household_id = p.household_id
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdMetaData_maled" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="clinicalVisitParams.geographic_region_maled" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="filter_item_id"/>
     <column name="record_id"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
                select  h.household_id as internal, h.household_observation_id as filter_item_id, ho.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HouseObsIO ho
                where h.household_id in ($$geographic_region_maled$$)
                and ho.household_id = h.household_id
       ]]>
     </sql>
   </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                select  h.household_id as internal, h.household_observation_id as filter_item_id, ho.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HouseObsIO ho
                where ho.household_id = h.household_id
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantMetaData_maled" isCacheable="false">
     <paramRef ref="clinicalVisitParams.households_maled" />  
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select p.participant_id as internal, hp.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO hp
where p.household_id in ($$households_maled$$)
and hp.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select p.participant_id as internal, hp.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO hp
where hp.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitMetaData_maled" isCacheable="false">
         <paramRef ref="clinicalVisitParams.participants_maled" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="filter_item_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select observation_id as internal, observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_maled$$)
          ]]>
    </sql>
    </sqlQuery>    



   <sqlQuery name="RelVisitMetaData_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  india ICEMR specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->


   <sqlQuery name="HouseholdMetaData_india" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="clinicalVisitParams.geographic_region_india" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_observation_id as filter_item_id, hp.participant_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where hp.household_id in ($$geographic_region_india$$)
and hp.household_id = h.household_id
and hp.participant_id = po.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/> 
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_observation_id as filter_item_id, hp.participant_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where hp.household_id = h.household_id
and hp.participant_id = po.participant_id
          ]]>
    </sql>
    </sqlQuery>


   <sqlQuery name="ParticipantMetaData_india" isCacheable="false">
     <paramRef ref="clinicalVisitParams.households_india" />  
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select p.participant_id as internal, po.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO po
where p.participant_id in ($$households_india$$)
and po.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select p.participant_id as internal, po.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO po
where po.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitMetaData_india" isCacheable="false">
         <paramRef ref="clinicalVisitParams.participants_india" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_india$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="RegionMetaData_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and hp.household_id = h.household_id
and hp.participant_id = po.participant_id
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="RelVisitMetaData_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  Amazonia peru ICEMR specific .. should be injected -->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->


   <sqlQuery name="HouseholdMetaData_amazperu" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="clinicalVisitParams.geographic_region_amazperu" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_id as filter_item_id, hp.participant_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where hp.participant_id in ($$geographic_region_amazperu$$)
and hp.household_id = h.household_id
and hp.participant_id = po.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/> 
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_id as filter_item_id, hp.participant_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where hp.household_id = h.household_id
and hp.participant_id = po.participant_id
          ]]>
    </sql>
    </sqlQuery>


   <sqlQuery name="ParticipantMetaData_amazperu" isCacheable="false">
     <paramRef ref="clinicalVisitParams.households_amazperu" />  
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select p.participant_id as internal, po.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO po
where p.participant_id in ($$households_amazperu$$)
and po.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select p.participant_id as internal, po.observation_id as record_id, p.ontology_term_name, p.string_value, p.number_value, p.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD p, ApidbTuning.$$tbl_prefix$$PartObsIO po
where po.participant_id = p.participant_id
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitMetaData_amazperu" isCacheable="false">
         <paramRef ref="clinicalVisitParams.participants_amazperu" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_amazperu$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="RegionMetaData_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as filter_item_id, hp.participant_id as internal, po.observation_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp, ApidbTuning.$$tbl_prefix$$PartObsIO po
where h.ontology_term_name in ('EUPATH_0022001','EUPATH_0021094')
and hp.household_id = h.household_id
and hp.participant_id = po.participant_id
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="RelVisitMetaData_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

  </querySet>    

</wdkModel>

<wdkModel>

  <paramSet name="participantParams">
    
    <enumParam name="type"
               prompt="type"
               multiPick="false"
               quote="true"
               visible="false">
      <help>this is internal</help>
      <enumList>
        <enumValue default="true">
          <term>person</term>
          <internal>person</internal>
        </enumValue>
        <enumValue>
          <term>household</term>
          <internal>household</internal>
        </enumValue>  
      </enumList>
    </enumParam>

    <stringParam name="dataset"
		 prompt="Study: "
		 number="false">
      <help>Specify the dataset for this study</help>
      <suggest default="Default Study"/>
    </stringParam>

        <stringParam name="tbl_prefix"
		 prompt="Table Prefix: "
		 number="false"
                 isSql="true">
      <help>Specify the dataset for this study</help>
      <suggest default="Default prefix"/>
    </stringParam>

    <numberParam name="duration_observation"
		 prompt="Minimum days of observation: "
		 integer="true"
                 min="1"
                 max="2000">
      <help>Specify the minimum number of days that the participant was observed (ie, met the age/date criteria).</help>
      <suggest default="1"/>
    </numberParam>

    <numberRangeParam name="visit_count"
                      prompt="Number of Matching Observations: "
                      integer="true"
                      min="1"
                      max="10000">
      <help>Set the range of number of observations that match your search criteria.</help>
      <!--         <suggest default="{'min': '1', 'max': '10'}" />  -->
    </numberRangeParam>

        <numberRangeParam name="visits_per_year"
                      prompt="Matching Observations per year:"
                      integer="false"
                      min="0"
                      max="365"
                      step="0.1">
      <help>Set the range of number of observations that match your search criteria to restrict the number of participants returned.</help>
      <suggest default="{'min': '0.1', 'max': '365'}" /> 
    </numberRangeParam>

    <numberRangeParam name="parasite_density"
                      prompt="Parasite Density (geometric mean):"
                      integer="true"
                      min="0"
                      max="1000000">
      <help>Set the range of days between observations to compare to observations selected in the previous step</help>
      <!--         <suggest default="{'min': '1', 'max': '10'}" />  -->
    </numberRangeParam> 


    <!-- TEMPLATE_ANCHOR participantSourceIdParam -->

    <!-- TEMPLATE_ANCHOR participantResultParam -->

    <!-- TEMPLATE_ANCHOR participantFilterParams -->


       <enumParam name="case_control"
                  prompt="Cases or Controls"
                  multiPick="false"
                  quote="false"
                  visible="true">
         <help>Choose whether to search for cases, controls or either.</help>
         <enumList>
           <enumValue default="true">
             <term>Both Cases and Controls</term>
             <internal>'case','control'</internal>
           </enumValue>
           <enumValue>
             <term>Cases</term>
             <internal>'case'</internal>
           </enumValue>
           <enumValue>
             <term>Controls</term>
             <internal>'control'</internal>
           </enumValue>  
         </enumList>
       </enumParam>

       <enumParam name="study_arm"
                  prompt="Study Arm"
                  multiPick="false"
                  quote="false"
                  visible="true">
         <help>Choose whether to search for cases, controls or either.</help>
         <enumList>
           <enumValue default="true">
             <term>Both Study Arms</term>
             <internal>'Both'</internal>
           </enumValue>
           <enumValue>
             <term>Moderate-to-severe diarrhea</term>
             <internal>'msd'</internal>
           </enumValue>
           <enumValue>
             <term>Less severe diarrhea</term>
             <internal>'lsd'</internal>
           </enumValue>  
         </enumList>
       </enumParam>

       <enumParam name="use_rel_case_control"
                prompt="Compare Cases / Controls"
                multiPick="false"
                quote="false"
                visible="true">
       <help>You MUST change this parameter to Yes in order to use relative observations! If you decide to not use relative observations, set this parameter to No and make certain "Keep or remove observations" is set to remove.</help>
         <enumList>
           <enumValue default="true">
             <term>No</term>
             <internal>0</internal>
           </enumValue>
           <enumValue>
             <term>Yes</term>
             <internal>1</internal>
           </enumValue>  
         </enumList>
       </enumParam>

        <flatVocabParam name="keep_remove"
               prompt="Keep or Remove participants based on case control comparisons"
               multiPick="false"
               quote="false"
               visible="true"
               dependedParamRef="participantParams.use_rel_case_control"
               queryRef="ParticipantVQ.KeepRemove">
      <help>Choose what to do as you compare cases and controls.  Do you want to keep or remove participants with cases and controls that match your selected criteria. </help>
    </flatVocabParam>

        <flatVocabParam name="study_type"
               prompt="Choose the study type"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef="participantParams.tbl_prefix"
               default="any"
               queryRef="ParticipantVQ.StudyType">
      <help>This study has multiple study types.  Choose which study type you want to search.</help>
    </flatVocabParam>

 
       <enumParam name="return_case_control"
                  prompt="Which participants to return"
                  multiPick="false"
                  quote="true"
                  visible="true">
         <help>Choose whether to return just the participants you have selected, to include the cases/controls for those selected participants, or to return only the related cases/controls for the selected participants.</help>
         <enumList>
           <enumValue default="true">
             <term>Return selected participants only</term>
             <internal>selected</internal>
           </enumValue>
           <enumValue>
             <term>Return both the selected participants and their matching cases/controls</term>
             <internal>caseid</internal>
           </enumValue>  
<!--           <enumValue>
             <term>Return only the matching cases / controls for the selected participants</term>
             <internal>matching</internal>
           </enumValue>  
-->
         </enumList>
       </enumParam>
       
  </paramSet>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  Vocab queries-->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

 <querySet name="ParticipantVQ" queryType="vocab" isCacheable="true">

    <!--************************************************************-->
    <!-- Anchor for participants filter params -->
    <!--************************************************************-->

    <!-- TEMPLATE_ANCHOR participantFilterParamQueries -->

     <sqlQuery name="KeepRemove">
          <paramRef ref="participantParams.use_rel_case_control" />  
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
            <![CDATA[
                     SELECT * from (
                     SELECT 'Remove' as display, 'remove' as term, 'MINUS' as internal from dual
                     UNION
                     SELECT 'Keep' as display, 'keep' as term, 'INTERSECT' as internal from dual
                     where $$use_rel_case_control$$ = 1  )
                     ORDER by term desc
            ]]>
            </sql>
        </sqlQuery>

     <sqlQuery name="StudyType">
          <paramRef ref="participantParams.tbl_prefix" />  
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
            <![CDATA[
            SELECT * from (
            SELECT 'Any' as display, 'any' as term, 'any' as internal from dual
            UNION
            select distinct initcap(string_value) as display, string_value as term, string_value as internal
--            from apidbtuning.$$tbl_prefix$$ParticipantMD
            from apidbtuning.Df6c59e88c1ParticipantMD
            where ontology_term_name = 'OBI_0500000'  )
            ORDER by term
            ]]>
            </sql>
        </sqlQuery>

  </querySet>    

      <groupSet name="metaDataGroups">
        
        <group name="daterange" displayName="Time Period / Age at Visit" displayType="ShowHide">
            <description>
                <![CDATA[
Filter participants based on the date range they were observed, the number of days they were observed in that period, and their age at each observation (ie clinical visit). Study data is available from 05-AUG-2011 to 30-JUN-2016.
                ]]>
            </description>
        </group>
        <group name="household_daterange" displayName="Time Period" displayType="ShowHide">
            <description>
                <![CDATA[
Filter households based on the date range they were in the study.  Note that the Average Anopheles is computed from monthly CDC light trap collections within this time frame.  
                ]]>
            </description>
        </group>
        <group name="age_at_visit" displayName="Age" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on their age at visits. Participants are removed if they have any visits within the previously selected Time Period where they were not within this Age range.  (The study included participants from age 0.5 to 11 years, and from 18 to 75 years of age.)
                ]]>
            </description>
        </group>
        <group name="lighttrap_characteristics" displayName="Entomology Collection" displayType="ShowHide">
            <description>
                <![CDATA[
		       Filter light trap collections based on their characteristics.
                ]]>
            </description>
        </group>
        <group name="part_characteristics" displayName="Participant" displayType="ShowHide">
            <description>
                <![CDATA[
		       Filter participants based on their characteristics that do not change over time.
                ]]>
            </description>
        </group>
        <group name="visit_part_characteristics" displayName="Participant" displayType="ShowHide">
            <description>
                <![CDATA[
You can restrict visits returned based on participants by selecting characteristics about where they live including their household type and their own characteristics such as genotype information.
                ]]>
            </description>
        </group>
        <group name="part_household_characteristics" displayName="Household" displayType="ShowHide">
            <description></description> <!-- no need for a descrip.  too obvious -->
        </group>
        <group name="part_village_characteristics" displayName="Village" displayType="ShowHide">
            <description>Village where participants live who are enrolled in this study.</description> 
        </group>
        <group name="geographic_loc" displayName="Geographic Region" displayType="ShowHide">
            <description></description> <!-- no need for a descrip.  too obvious -->
        </group>
        <group name="visit_visit_characteristics" displayName="Visits" displayType="ShowHide">
            <description>
                <![CDATA[
You can restrict the observations returned in your search by selecting characteristics such as the type of observation, diagnosis, observation type, etc.
                ]]>
            </description>
        </group>
        <group name="visit_characteristics" displayName="Visits" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter observations based on observations at visits.  Visits shown are from the period when the selected participants meet the age range specified in the Age filter    
             ]]>
            </description>
        </group>
        <group name="event_characteristics" displayName="Observation" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter observations based on information gained at those observations. 
             ]]>
            </description>
        </group>
       <group name="part_visit_characteristics" displayName="Observation" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on observations at visits.  Observations shown are for the selected set of participants when they were within the age range specified in the Age filter.  Change the default values for the Observations per Year parameter to restrict the participants based on your selected observation values.
                ]]>
            </description>
        </group>
        <group name="observ_visit_characteristics" displayName="Observation" displayType="ShowHide">
            <description>
                <![CDATA[
    Observations shown are for the selected set of participants when they were within the age range specified in the Age filter.  Change the default values for the Observations per Year parameter to restrict observations returned based on your selected observation values.
                ]]>
            </description>
        </group>
       <group name="part_event_characteristics" displayName="Observation" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on information gained at observations. Data collected at different timepoints may require a multi-step search strategy to access.     
                ]]>
            </description>
        </group>
       <group name="part_sample_characteristics" displayName="Sample" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on information derived from samples collected in the study.     
                ]]>
            </description>
        </group>
        <group name="summary_params" displayName="Visit aggregates" displayType="ShowHide">
            <description>
                <![CDATA[
You can further restrict the participants returned in your search by setting summary values such as the average parasitemia or the number of visits / year of the visits matching the previous step characteristics.
                ]]>
            </description>
        </group>
        <group name="event_summary_params" displayName="# Observations selected" displayType="ShowHide">
            <description>
                <![CDATA[
You can further restrict the participants returned in your search by setting a range of the number of observations per participant that meet your search criteria. 
                ]]>
            </description>
        </group>
        <group name="relative_visits" displayName="Related Observation" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can further restrict the observations you selected in the previous step by removing (or keeping) those observations based on related observations you define below.  For example, you may want to only keep observations with a diagnosis of asymptomatic parasitemia if they are not followed within 14 days by an observation where the participant was diagnosed with malaria.  In this example, set the days between observations to 1 to 14 and direction to before to remove observations where the related observation diagnosis of malaria = yes.
                ]]>
            </description>
        </group>

        <group name="relative_events" displayName="Related Observation" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can restrict the observations you have previously selected by removing (or keeping) those observations based on related observations you define below. For example, you may want to only keep diarrheal observations if they are followed between 0 - 5 days by an observation where a laboratory test was positive for shigella.
                ]]>
            </description>
        </group>

        <group name="relative_case_control" displayName="Related Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can restrict the participants you have previously selected by removing (or keeping) participants based on differences or similarities between matched cases and controls. 
                ]]>
            </description>
        </group>

        <group name="results_options" displayName="Results Options" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose whether to return just the participants selected in this search, include the matching cases (or controls) for the participants selected or only the matching cases (or controls) for the selected participants.
                ]]>
            </description>
        </group>
        
        <group name="choose_study_arm" displayName="Study Details" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose participants you want to include in your search based on study details. 
                ]]>
            </description>
        </group>
 
        <group name="choose_case_control" displayName="Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose whether to query just cases, just controls or both. 
                ]]>
            </description>
        </group>
 
        <group name="study_arm_case_control" displayName="Study Arm, Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose the study arm and whether to query just cases, just controls or both. 
                ]]>
            </description>
        </group>
 
        <group name="choose_study_type" displayName="Study type" displayType="ShowHide">
            <description>
                <![CDATA[
                         This study contains multiple study types. Choose which study type to include in this search.
                ]]>
            </description>
        </group>

        <group name="treatment" displayName="Treatment" displayType="ShowHide">
            <description>
                <![CDATA[
                         Limit this search based on treatment.
                ]]>
            </description>
        </group>

        <group name="relative_treatment" displayName="Related Treatment" displayType="ShowHide">
            <description>
                <![CDATA[
                         Limit the related observations based on treatment.
                ]]>
            </description>
        </group>

        <group name="date_region" displayName="Date and Region" displayType="ShowHide">
            <description>
                <![CDATA[
                         Limit the search based on observation date and geographic region
                ]]>
            </description>
        </group>

    </groupSet>

</wdkModel>

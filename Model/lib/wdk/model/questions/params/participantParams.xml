<wdkModel>

  <paramSet name="participantParams">
    
    <enumParam name="type"
               prompt="type"
               multiPick="false"
               quote="true"
               visible="false">
      <help>this is internal</help>
      <enumList>
        <enumValue default="true">
          <term>person</term>
          <internal>person</internal>
        </enumValue>
        <enumValue>
          <term>household</term>
          <internal>household</internal>
        </enumValue>  
      </enumList>
    </enumParam>

    <stringParam name="dataset"
		 prompt="Study: "
		 number="false">
      <help>Specify the dataset for this study</help>
      <suggest default="Default Study"/>
    </stringParam>

        <stringParam name="tbl_prefix"
		 prompt="Table Prefix: "
		 number="false"
                 isSql="true">
      <help>Specify the dataset for this study</help>
      <suggest default="Default prefix"/>
    </stringParam>

    <numberParam name="duration_observation"
		 prompt="Minimum days of observation: "
		 integer="true"
                 min="1"
                 max="2000">
      <help>Specify the minimum number of days that the participant was observed (ie, met the age/date criteria).</help>
      <suggest default="1"/>
    </numberParam>

    <numberRangeParam name="visit_count"
                      prompt="Number of Matching Observations: "
                      integer="true"
                      min="1"
                      max="10000">
      <help>Set the range of number of observations that match your search criteria.</help>
      <!--         <suggest default="{'min': '1', 'max': '10'}" />  -->
    </numberRangeParam>

        <numberRangeParam name="visits_per_year"
                      prompt="Matching Observations per year:"
                      integer="false"
                      min="0"
                      max="365"
                      step="0.1">
      <help>Set the range of number of observations that match your search criteria to restrict the number of participants returned.</help>
      <suggest default="{'min': '0.1', 'max': '365'}" /> 
    </numberRangeParam>

    <numberRangeParam name="parasite_density"
                      prompt="Parasite Density (geometric mean):"
                      integer="true"
                      min="0"
                      max="1000000">
      <help>Set the range of days between observations to compare to observations selected in the previous step</help>
      <!--         <suggest default="{'min': '1', 'max': '10'}" />  -->
    </numberRangeParam> 


    <!-- TEMPLATE_ANCHOR participantSourceIdParam -->

    <!-- TEMPLATE_ANCHOR participantResultParam -->

<!--
    <filterParam name="participant_record_page" 
                 ontologyQueryRef="ParticipantVQ.RecordPageOntology"
                 metadataQueryRef="ParticipantVQ.RecordPageMetaData"
                 backgroundQueryRef="ParticipantVQ.RecordPageMetaData"
                 filterDataTypeDisplayName="Participants"
                 prompt="Participants"
                 countPredictsAnswerCount="true"
                 trimMetadataTerms="true"
                 dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select participants based on their geographic region. 
      </help>
    </filterParam>
-->

    <!--************************************************************-->
    <!--   Template-->
    <!--************************************************************-->

       <filterParam name="geographic_region_template" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_template"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_template"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_template"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       dependedParamRef="participantParams.tbl_prefix"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_template" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_template"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_template"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_template"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Observations"
                       prompt="Households"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_template"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

       <filterParam name="participants_template" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_template"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_template"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_template"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix,participantParams.households_template">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_template" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_template"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_template"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_template"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_template">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>


    <!--************************************************************-->
    <!--   PRISM and PRISM2 section ... should be injected  -->
    <!--************************************************************-->

       <filterParam name="geographic_region_prism" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_prism"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_prism"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_prism"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       countPredictsAnswerCount="true"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="visits_visitage_metadata_prism" 
                    ontologyQueryRef="ParticipantVQ.VisitAgeOntology_prism"
                    metadataQueryRef="ParticipantVQ.VisitAgeMetaData_prism"
                    backgroundQueryRef="ParticipantVQ.VisitAgeMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Age at visit"
                    filterDataTypeDisplayName="Participants"
                    dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_prism"
                    trimMetadataTerms="true">
      <help>
        Select reference samples. 
      </help>
    </filterParam>
    
    <filterParam name="participants_prism" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_prism"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_prism"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_prism"
                    countPredictsAnswerCount="true"
                    prompt="Participants"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix,participantParams.visits_visitage_metadata_prism,clinicalVisitParams.visit_date,participantParams.duration_observation,participantParams.geographic_region_prism">
      <help>
        Select participants based on their characteristics. 
      </help>
    </filterParam>


    <filterParam name="households_prism" 
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_prism"
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_prism"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_prism"
                    filterDataTypeDisplayName="Households"
                    countPredictsAnswerCount="true"
                    prompt="Households"
                    dependedParamRef="participantParams.tbl_prefix,clinicalVisitParams.visit_date,participantParams.participants_prism"
                    trimMetadataTerms="true">
      <help>
        Select participants based on the characteristics of the household where they live. 
      </help>
    </filterParam>

    <filterParam name="visits_prism" 
                    metadataQueryRef="ParticipantVQ.VisitMetaData_prism"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_prism"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix,participantParams.visits_visitage_metadata_prism,participantParams.households_prism,clinicalVisitParams.visit_date">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>

        <filterParam name="relative_visits_prism" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_prism"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>



    <!--************************************************************-->
    <!--   MAL-ED section ... should be injected  -->
    <!--************************************************************-->

       <filterParam name="geographic_region_maled" 
                       metadataQueryRef="ParticipantVQ.RegionMetaData_maled"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_maled"
                       ontologyQueryRef="ParticipantVQ.RegionOntology_maled"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Participants"
                       prompt="Geographic region"
                       dependedParamRef="participantParams.tbl_prefix"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_maled" 
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_maled"
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_maled"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_maled"
                    filterDataTypeDisplayName="Households"
                    countPredictsAnswerCount="true"
                    prompt="Households"
                    dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_maled"
                    trimMetadataTerms="true">
      <help>
        Select participants based on the characteristics of the household where they live. 
      </help>
    </filterParam>
 
       <filterParam name="participants_maled" 
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_maled"
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_maled"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_maled"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix,participantParams.households_maled">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_maled" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_maled"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_maled"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_maled"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_maled">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    <!--************************************************************-->
    <!--   india ICEMR section ... should be injected  -->
    <!--************************************************************-->

       <filterParam name="geographic_region_india" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_india"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_india"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_india"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       dependedParamRef="participantParams.tbl_prefix"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_india" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_india"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_india"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_india"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Observations"
                       prompt="Households"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_india"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

       <filterParam name="participants_india" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_india"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_india"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_india"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix,participantParams.households_india">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_india" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_india"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_india"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_india"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_india">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    <!--************************************************************-->
    <!--   India Fever Study ICEMR section ... should be injected  -->
    <!--************************************************************-->

       <filterParam name="participants_indiaFS" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_indiaFS"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_indiaFS"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaData_indiaFS"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_indiaFS" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_indiaFS"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_indiaFS"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_indiaFS"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_indiaFS">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    <!--************************************************************-->
    <!--   Amazonia peru ICEMR section ... should be injected  -->
    <!--************************************************************-->

       <filterParam name="geographic_region_amazperu" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_amazperu"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_amazperu"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_amazperu"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       dependedParamRef="participantParams.tbl_prefix"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_amazperu" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_amazperu"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_amazperu"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_amazperu"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Households"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_amazperu"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

       <filterParam name="participants_amazperu" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_amazperu"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_amazperu"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_amazperu"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix,participantParams.households_amazperu">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_amazperu" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_amazperu"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_amazperu"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_amazperu"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_amazperu">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

       
    <!--************************************************************-->
    <!--   South Asia ICEMR section ... -->
    <!--************************************************************-->
    
       <filterParam name="participants_sasia" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_sasia"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_sasia"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaData_sasia"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.tbl_prefix">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_sasia" 
                       ontologyQueryRef="ParticipantVQ.VisitOntology_sasia"
                       metadataQueryRef="ParticipantVQ.VisitMetaData_sasia"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_sasia"
                       countPredictsAnswerCount="true"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participants_sasia">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

       <filterParam name="treatment_sasia" 
                       ontologyQueryRef="ParticipantVQ.TreatmentOntology_sasia"
                       metadataQueryRef="ParticipantVQ.TreatmentMetaData_sasia"
                       backgroundQueryRef="ParticipantVQ.TreatmentMetaDataBkgd_sasia"
                       countPredictsAnswerCount="true"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.visits_sasia">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    <filterParam name="relative_visits_sasia" 
                    metadataQueryRef="ParticipantVQ.RelVisitMetaData_sasia"
                    backgroundQueryRef="ParticipantVQ.RelVisitMetaData_sasia"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_sasia"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.tbl_prefix">
      <help>
        Select related observations based on their characteristics. 
      </help>
    </filterParam>

       <filterParam name="relative_treatment_sasia" 
                       ontologyQueryRef="ParticipantVQ.TreatmentOntology_sasia"
                       metadataQueryRef="ParticipantVQ.RelativeTreatmentMetaData_sasia"
                       backgroundQueryRef="ParticipantVQ.TreatmentMetaDataBkgd_sasia"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.relative_visits_sasia">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    
    <!--************************************************************-->
    <!--   GEMS1 and GEMS1a section ... -->
    <!--************************************************************-->


       <filterParam name="geographic_region_gems" 
                       ontologyQueryRef="ParticipantVQ.GeographicRegionOntology_gems" 
                       metadataQueryRef="ParticipantVQ.GeographicRegionMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.GeographicRegionMetaDataBkg_gems"
                       filterDataTypeDisplayName="Participants"
                       prompt="Study Site"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.case_control,participantParams.study_arm">
         <help>
           Select participants based on their study site.
         </help>
       </filterParam>

       <filterParam name="household_gems" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_gems"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkg_gems"
                       filterDataTypeDisplayName="Observations"
                       prompt="Household"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.geographic_region_gems">
         <help>
           Select participants based on household characteristics. 
         </help>
       </filterParam>
       
       <filterParam name="participant_gems" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_gems"
                       metadataQueryRef="ParticipantVQ.ParticipantMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkg_gems"
                       filterDataTypeDisplayName="Participants"
                       prompt="Participant"
                       trimMetadataTerms="false"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.household_gems">
         <help>
           Select participants based on their personal characteristics. 
         </help>
       </filterParam>

       <filterParam name="event_gems" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_gems"
                       metadataQueryRef="ParticipantVQ.ObservationMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_gems"
                       filterDataTypeDisplayName="Observations"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.participant_gems">
         <help>
           Select participants based on variables associated with their enrollment or followup events. 
         </help>
       </filterParam>       

      <filterParam name="relative_event_gems" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_gems"
                       metadataQueryRef="ParticipantVQ.RelativeCasecontrolObservationMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_gems"
                       filterDataTypeDisplayName="Observations"
                       prompt="Related Case or Control"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.tbl_prefix,participantParams.case_control">
         <help>
           Modify participants selected based on information about their related case or control. 
         </help>
       </filterParam>    

       <enumParam name="case_control"
                  prompt="Cases or Controls"
                  multiPick="false"
                  quote="false"
                  visible="true">
         <help>Choose whether to search for cases, controls or either.</help>
         <enumList>
           <enumValue default="true">
             <term>Both Cases and Controls</term>
             <internal>'case','control'</internal>
           </enumValue>
           <enumValue>
             <term>Cases</term>
             <internal>'case'</internal>
           </enumValue>
           <enumValue>
             <term>Controls</term>
             <internal>'control'</internal>
           </enumValue>  
         </enumList>
       </enumParam>

       <enumParam name="study_arm"
                  prompt="Study Arm"
                  multiPick="false"
                  quote="false"
                  visible="true">
         <help>Choose whether to search for cases, controls or either.</help>
         <enumList>
           <enumValue default="true">
             <term>Both Study Arms</term>
             <internal>'Both'</internal>
           </enumValue>
           <enumValue>
             <term>Moderate-to-severe diarrhea</term>
             <internal>'msd'</internal>
           </enumValue>
           <enumValue>
             <term>Less severe diarrhea</term>
             <internal>'lsd'</internal>
           </enumValue>  
         </enumList>
       </enumParam>

       <enumParam name="use_rel_case_control"
                prompt="Compare Cases / Controls"
                multiPick="false"
                quote="false"
                visible="true">
       <help>You MUST change this parameter to Yes in order to use relative observations! If you decide to not use relative observations, set this parameter to No and make certain "Keep or remove observations" is set to remove.</help>
         <enumList>
           <enumValue default="true">
             <term>No</term>
             <internal>0</internal>
           </enumValue>
           <enumValue>
             <term>Yes</term>
             <internal>1</internal>
           </enumValue>  
         </enumList>
       </enumParam>

        <flatVocabParam name="keep_remove"
               prompt="Keep or Remove participants based on case control comparisons"
               multiPick="false"
               quote="false"
               visible="true"
               dependedParamRef="participantParams.use_rel_case_control"
               queryRef="ParticipantVQ.KeepRemove">
      <help>Choose what to do as you compare cases and controls.  Do you want to keep or remove participants with cases and controls that match your selected criteria. </help>
    </flatVocabParam>

        <flatVocabParam name="study_type"
               prompt="Choose the study type"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef="participantParams.tbl_prefix"
               default="any"
               queryRef="ParticipantVQ.StudyType">
      <help>This study has multiple study types.  Choose which study type you want to search.</help>
    </flatVocabParam>

 
       <enumParam name="return_case_control"
                  prompt="Which participants to return"
                  multiPick="false"
                  quote="true"
                  visible="true">
         <help>Choose whether to return just the participants you have selected, to include the cases/controls for those selected participants, or to return only the related cases/controls for the selected participants.</help>
         <enumList>
           <enumValue default="true">
             <term>Return selected participants only</term>
             <internal>selected</internal>
           </enumValue>
           <enumValue>
             <term>Return both the selected participants and their matching cases/controls</term>
             <internal>caseid</internal>
           </enumValue>  
<!--           <enumValue>
             <term>Return only the matching cases / controls for the selected participants</term>
             <internal>matching</internal>
           </enumValue>  
-->
         </enumList>
       </enumParam>
       
  </paramSet>

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!--  Vocab queries-->  
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

 <querySet name="ParticipantVQ" queryType="vocab" isCacheable="true">

    <!--************************************************************-->
    <!--   Template  -->
    <!--************************************************************-->

   <sqlQuery name="RegionOntology_template" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_template" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdOntology_template" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000001','EUPATH_0000003','EUPATH_0000343','EUPATH_0000441','EUPATH_0021093') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name != 'EUPATH_0000094'
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
     order by display_order, display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_template" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.geographic_region_template" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where hp.household_id in ($$geographic_region_template$$)
and h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_template" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_template" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000425','EUPATH_0000430','EUPATH_0000431','EUPATH_0000440','EUPATH_0000451') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_template" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.households_template" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
where participant_id in ($$households_template$$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_template" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_template" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000344','EUPATH_0000413','EUPATH_0000439','EUPATH_0021002','EUPATH_0000423','EUPATH_0000433','EUPATH_0000437','EUPATH_0000438','OBI_0000655') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_template" isCacheable="false">
         <paramRef ref="participantParams.participants_template" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_template$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_template" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

    <!--************************************************************-->
    <!--   PRISM and PRISM2 section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="RegionOntology_prism" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
where ontology_term_source_id = 'EUPATH_0000054'
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_prism" isCacheable="false" >
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select m.pan_id as filter_item_id,  io.output_pan_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.$$tbl_prefix$$MetaData m, ApidbTuning.$$tbl_prefix$$PANIO io
 where m.property_source_id = 'EUPATH_0000054'
 and io.input_pan_id = m.pan_id
 and io.output_pan_type_source_id = 'EUPATH_0000096'
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitAgeOntology_prism" isCacheable="true">
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="parent_ontology_term_name"/>
         <column name="display_name"/>
         <column name="description"/>
         <column name="type"/>
         <column name="units"/>
         <column name="precision"/>
         <column name="is_range"/>
         <sql>
           <![CDATA[
                       select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
where ontology_term_source_id = 'EUPATH_0000113'
    ]]>   
        </sql>
      </sqlQuery>
          
      <sqlQuery name="VisitAgeMetaData_prism" isCacheable="false">
        <paramRef ref="participantParams.tbl_prefix" />  
        <paramRef ref="participantParams.geographic_region_prism" /> 
        <column name="ontology_term_name"/>
        <column name="internal"/>
        <column name="number_value"/>
        <column name="date_value"/>
        <column name="string_value"/>
        <sql>
        <![CDATA[
  select m.pan_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from  ApidbTuning.$$tbl_prefix$$metadata m,
 (select distinct io.input_pan_id, io.output_pan_id
  from ApidbTuning.$$tbl_prefix$$PANIO io
  where io.input_pan_id in ($$geographic_region_prism$$)
  and output_pan_type_source_id = 'EUPATH_0000738'
  ) pa
  where pa.output_pan_id = m.pan_id
  and m.property_source_id = 'EUPATH_0000113'
         ]]>   
      </sql>
   </sqlQuery>

      <sqlQuery name="VisitAgeMetaDataBkgd_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
  select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD m
where m.ontology_term_name = 'EUPATH_0000113'
          ]]>   
      </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantOntology_prism" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
) order by display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_prism" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.visits_visitage_metadata_prism" />
     <paramRef ref="clinicalVisitParams.visit_date" /> 
     <paramRef ref="participantParams.duration_observation" />  
     <paramRef ref="participantParams.geographic_region_prism" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
select distinct m.pan_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
  from (select min(EUPATH_0000113) as min_age, max(EUPATH_0000113) as max_age
   from ApidbTuning.$$tbl_prefix$$Observations 
   where pan_id in ($$visits_visitage_metadata_prism$$)
   ) age,
   ApidbTuning.$$tbl_prefix$$Participants pa, ApidbTuning.$$tbl_prefix$$PANIO iov, ApidbTuning.$$tbl_prefix$$MetaData m, ApidbTuning.$$tbl_prefix$$Observations obs
   where least(pa.EUPATH_0000152, $$visit_date.max$$, pa.EFO_0004950 + ( age.max_age * 365)) - 
       greatest(pa.EUPATH_0000151, $$visit_date.min$$, pa.EFO_0004950 + ( age.min_age * 365)) + 1 >= $$duration_observation$$
       and pa.pan_id = iov.input_pan_id
       and iov.output_pan_id in ($$visits_visitage_metadata_prism$$)
       and iov.output_pan_id = obs.pan_id
       and obs.EUPATH_0000091 >= $$visit_date.min$$ 
       and obs.EUPATH_0000091 <= $$visit_date.max$$ 
       and pa.pan_id = m.pan_id       
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select distinct m.pan_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$MetaData m
 where m.category = 'Participant'
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdOntology_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000144') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('PCO_0000024','ENVO_01000744')
 union
 select 'average_anopheles' as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, 'Average Female Anopheles Collected' as display_name, 'Average number of female Anopheles mosquitoes collected per house per night using CDC light traps set up once a month during the dates of this search' as description, null as units, 'number' as type, 1 as is_range,
 null as precision from dual)
 where ontology_term_name not in ('EUPATH_0000094')
 order by display_name
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_prism" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <paramRef ref="clinicalVisitParams.visit_date" /> 
      <paramRef ref="participantParams.participants_prism" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from  ApidbTuning.$$tbl_prefix$$PANIO io
   where io.output_pan_id in ($$participants_prism$$)
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.$$tbl_prefix$$MetaData m, part
 where part.household_id = m.pan_id
 union all
 select distinct part.household_id as filter_item_id, part.part_id as internal, 'average_anopheles' as ontology_term_name, null as string_value, nvl(mos.avg_anoph,0) as number_value, null as date_value
 from (select da.pan_id, round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as avg_anoph
  from ApidbTuning.$$tbl_prefix$$Households da, ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$LightTraps la
  where da.pan_id = io.input_pan_id
  and la.pan_id = io.output_pan_id
  and la.EUPATH_0020003 >= $$visit_date.min$$ 
  and la.EUPATH_0020003 <= $$visit_date.max$$ 
  group by da.pan_id) mos, part
  where part.household_id = mos.pan_id(+)
          ]]>
    </sql>    

    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
  with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from ApidbTuning.$$tbl_prefix$$PANIO io
   where io.output_pan_type_source_id = 'EUPATH_0000096'
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.$$tbl_prefix$$MetaData m, part
 where part.household_id = m.pan_id
 union all
 select distinct part.household_id as filter_item_id, part.part_id as internal, 'average_anopheles' as ontology_term_name, null as string_value, nvl(mos.avg_anoph,0) as number_value, null as date_value
 from (select io.input_pan_id as pan_id, round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as avg_anoph
  from ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$LightTraps la
  where io.input_pan_type_source_id = 'PCO_0000024'
  and io.output_pan_type_source_id = 'EUPATH_0000327'
  and la.pan_id = io.output_pan_id
  group by io.input_pan_id) mos, part
  where part.household_id = mos.pan_id(+)
          ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="VisitOntology_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
        <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0021002') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name != 'EFO_0004950'
     order by display_name
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitMetaData_prism" isCacheable="false">
         <paramRef ref="participantParams.tbl_prefix" />  
         <paramRef ref="participantParams.visits_visitage_metadata_prism" />
         <paramRef ref="clinicalVisitParams.visit_date" /> 
         <paramRef ref="participantParams.households_prism" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
with valid as (
select distinct io.output_pan_id as visit_id, io.input_pan_id as part_id
from ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$Observations obs
where io.input_pan_id in ($$households_prism$$)
and io.output_pan_id in ($$visits_visitage_metadata_prism$$)
and obs.pan_id = io.output_pan_id
and obs.EUPATH_0000091 >= $$visit_date.min$$ 
and obs.EUPATH_0000091 <= $$visit_date.max$$ 
)
select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.$$tbl_prefix$$ObservationMD m, valid
 where m.observation_id = valid.visit_id
/*
  union all
 select valid.visit_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$MetaData m, valid, ApidbTuning.$$tbl_prefix$$PANIO ios
where m.property_source_id = 'OBI_0100051'
and ios.output_pan_id = m.pan_id
and ios.input_pan_id = valid.visit_id
*/
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_prism" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

    <!--************************************************************-->
    <!--   MAL-ED section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="HouseholdOntology_maled" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
 select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, 
 nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('PCO_0000024')
union
 select distinct o.ontology_term_source_id as ontology_term_name, 'PCO_0000024' as parent_ontology_term_name, 
 nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
where ontology_term_source_id = 'EUPATH_0000644'
     )
     where ontology_term_name not in ('EUPATH_0000095','OBI_0001627','GAZ_00000448')
     order by display_name --display_order
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_maled" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.geographic_region_maled" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="filter_item_id"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
                select  hp.participant_id as internal, h.household_observation_id as filter_item_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
                where h.household_id in ($$geographic_region_maled$$)
                and h.household_id = hp.household_id 
       ]]>
     </sql>
   </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                select  hp.participant_id as internal, h.household_observation_id as filter_item_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
                where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_maled" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
     )
     where ontology_term_name != 'EUPATH_0000095'
     order by display_name --display_order
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_maled" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.households_maled" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
where participant_id in ($$households_maled$$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_maled" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('NCBITaxon_2','NCBITaxon_2759','NCBITaxon_10239') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in ('EUPATH_0000091','OBI_0001616','EUPATH_0010859','EUPATH_0010860','EUPATH_0010861','EUPATH_0010857')
     order by display_name --display_order
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_maled" isCacheable="false">
         <paramRef ref="participantParams.participants_maled" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_maled$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="RegionOntology_maled" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.$$tbl_prefix$$Ontology o
where ontology_term_source_id = 'OBI_0001627'
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_maled" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  household_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD
 where ontology_term_name = 'OBI_0001627'
        ]]>
      </sql>
    </sqlQuery>

    <!--************************************************************-->
    <!--   South Asia ICEMR section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="ParticipantOntology_sasia" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
     UNION
     select distinct ontology_term_source_id as ontology_term_name, 'EUPATH_0000096' as parent_ontology_term_name, nvl(display_name,ontology_term_name) as display_name, description, units,type,is_range,precision, 0.5 as display_order
     from ApidbTuning.$$tbl_prefix$$Ontology 
     where ontology_term_source_id = 'EUPATH_0021095'
     )
     where ontology_term_name != 'EUPATH_0000095'
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_sasia" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
where participant_id not in ('29082466','29082990')
UNION
select  distinct household_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD 
where household_id not in ('29082466','29082990')
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitOntology_sasia" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('NCBITaxon_10239') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name != 'EUPATH_0000091'
     and ontology_term_name not in (select distinct ontology_term_name
from ApidbTuning.$$tbl_prefix$$ObservationMD
where sub_observation_id in (select distinct sub_observation_id from ApidbTuning.$$tbl_prefix$$ObsObsIO))
     order by display_order
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_sasia" isCacheable="false">
         <paramRef ref="participantParams.participants_sasia" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_sasia$$)
and sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.$$tbl_prefix$$ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_sasia" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.$$tbl_prefix$$ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="TreatmentOntology_sasia" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
o.type, o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$ObservationMD md, ApidbTuning.$$tbl_prefix$$Ontology o
where md.sub_observation_id in (select distinct sub_observation_id from ApidbTuning.$$tbl_prefix$$ObsObsIO)
and o.ontology_term_source_id = Md.Ontology_Term_Name)
order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="TreatmentMetaData_sasia" isCacheable="false">
         <paramRef ref="participantParams.visits_sasia" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="filter_item_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where observation_id in ($$visits_sasia$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="TreatmentMetaDataBkgd_sasia" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="RelVisitMetaData_sasia" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.$$tbl_prefix$$ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>
   
       <sqlQuery name="RelativeTreatmentMetaData_sasia" isCacheable="false">
         <paramRef ref="participantParams.relative_visits_sasia" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="filter_item_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where observation_id in ($$relative_visits_sasia$$)
          ]]>
    </sql>
    </sqlQuery>    

    
    <!--************************************************************-->
    <!--   India ICEMR section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="RegionOntology_india" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdOntology_india" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000001','EUPATH_0000003','EUPATH_0000343','EUPATH_0000441','EUPATH_0021093') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name != 'EUPATH_0000094'
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
     order by display_order, display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_india" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.geographic_region_india" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where hp.household_id in ($$geographic_region_india$$)
and h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_india" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000425','EUPATH_0000430','EUPATH_0000431','EUPATH_0000440','EUPATH_0000451') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_india" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.households_india" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
where participant_id in ($$households_india$$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_india" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000344','EUPATH_0000413','EUPATH_0000439','EUPATH_0021002','EUPATH_0000423','EUPATH_0000433','EUPATH_0000437','EUPATH_0000438','OBI_0000655') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_india" isCacheable="false">
         <paramRef ref="participantParams.participants_india" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_india$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_india" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>

    <!--************************************************************-->
    <!--   india fever study ICEMR section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="ParticipantOntology_indiaFS" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000425','EUPATH_0000430','EUPATH_0000431','EUPATH_0000440','EUPATH_0000451') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_indiaFS" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
          ]]>
    </sql>
    </sqlQuery>
    
    <sqlQuery name="VisitOntology_indiaFS" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0021129', 'EUPATH_0021128','EUPATH_0000344','EUPATH_0000413','EUPATH_0000439','EUPATH_0021002','EUPATH_0000423','EUPATH_0000433','EUPATH_0000437','EUPATH_0000438','OBI_0000655') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_indiaFS" isCacheable="false">
         <paramRef ref="participantParams.participants_indiaFS" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_indiaFS$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_indiaFS" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>


    <!--************************************************************-->
    <!--   Amazonia peru ICEMR section ... should be injected  -->
    <!--************************************************************-->

   <sqlQuery name="RegionOntology_amazperu" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
where o.ontology_term_source_id in ('EUPATH_0022001','EUPATH_0021094')
order by o.display_order
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.ontology_term_name in ('EUPATH_0022001','EUPATH_0021094')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdOntology_amazperu" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000144') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name != 'EUPATH_0000094'
     order by display_order,display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_amazperu" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.geographic_region_amazperu" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where hp.participant_id in ($$geographic_region_amazperu$$)
and h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  h.household_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD h, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_amazperu" isCacheable="true">
     <paramRef ref="participantParams.tbl_prefix" />  
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units, o.type, o.is_range, o.precision, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_amazperu" isCacheable="false">
     <paramRef ref="participantParams.tbl_prefix" />  
     <paramRef ref="participantParams.households_amazperu" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
where participant_id in ($$households_amazperu$$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_amazperu" isCacheable="true">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
     )
     order by display_order,display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_amazperu" isCacheable="false">
         <paramRef ref="participantParams.participants_amazperu" />  
         <paramRef ref="participantParams.tbl_prefix" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participants_amazperu$$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_amazperu" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>
    </sqlQuery>


    <!--************************************************************-->
    <!--   GEMS1 and GEMS1a section ... -->
    <!--************************************************************-->

    <sqlQuery name="GeographicRegionOntology_gems">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from apidbtuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('OBI_0001627')
     UNION
      select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from apidbtuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.ontology_term_source_id = PRIOR o.parent_ontology_term_source_id
     START WITH o.ontology_term_source_id in ('OBI_0001627')
          ]]>
      </sql>
    </sqlQuery>
    <sqlQuery name="GeographicRegionMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <paramRef ref="participantParams.case_control" />  
      <paramRef ref="participantParams.study_arm" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD m, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where m.ontology_term_name = 'OBI_0001627'
and m.household_id = hp.household_id 
and hp.participant_id in (select pan_id
       from ApidbTuning.$$tbl_prefix$$Participants
       where lower(EUPATH_0010375) in ($$case_control$$))
and ('Both' = $$study_arm$$
       or hp.participant_id in (select participant_id
       from ApidbTuning.$$tbl_prefix$$ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and lower(string_value) in ($$study_arm$$)))
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="GeographicRegionMetaDataBkg_gems" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD m, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where m.ontology_term_name = 'OBI_0001627'
and m.household_id = hp.household_id  
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="HouseholdOntology_gems">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in ('ENVO_00003064','EUPATH_0000023','EUPATH_0000144','EUPATH_0000343','EUPATH_0010381','EUPATH_0010398','EUPATH_0010399','EUPATH_0010400','EUPATH_0010401') AND o.type is null THEN 'multiFilter' ELSE o.type END as type, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'PCO_0000024'
) where ontology_term_name not in ('GAZ_00000448','OBI_0001627','EUPATH_0000094','EUPATH_0010049','EUPATH_0010048','EUPATH_0010373','EUPATH_0000725','EUPATH_0010226')
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_gems" />  
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                  select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD m, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where hp.household_id in ($$geographic_region_gems$$)
and m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkg_gems" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_gems" />  
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$HouseholdMD m, ApidbTuning.$$tbl_prefix$$HousePartIO hp
where m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantOntology_gems">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0010425') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
) where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094','EUPATH_0010049','EUPATH_0010048','EUPATH_0010373','EUPATH_0000725','EUPATH_0010226')
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.household_gems" />  
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD m
where m.participant_id in ($$household_gems$$)
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkg_gems" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.$$tbl_prefix$$ParticipantMD m
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationOntology_gems">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000321','EUPATH_0010011','EUPATH_0010351','EUPATH_0010357','EUPATH_0010378','EUPATH_0010379','EUPATH_0010380','EUPATH_0010383','EUPATH_0010389','EUPATH_0010390','EUPATH_0010391','EUPATH_0010393','EUPATH_0010394','EUPATH_0010395','EUPATH_0010040','NCBITaxon_10239','NCBITaxon_2','NCBITaxon_2759') AND o.type is null THEN 'multiFilter' ELSE o.type END as type, o.display_order
from ApidbTuning.$$tbl_prefix$$Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
) where ontology_term_name not in ('OBI_0001616','EUPATH_0000094','EUPATH_0010049','EUPATH_0010048','EUPATH_0010373','EUPATH_0000725','EUPATH_0010226')
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ObservationMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.participant_gems" />  
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in ($$participant_gems$$)
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationMetaDataBkg_gems" isCacheable="false">
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="RelativeCasecontrolObservationMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.case_control" />  
      <paramRef ref="participantParams.tbl_prefix" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.$$tbl_prefix$$ObservationMD
where participant_id in (select pan_id
       from ApidbTuning.$$tbl_prefix$$Participants
       where lower(EUPATH_0010375) not in ($$case_control$$) )
          ]]>
    </sql>    
    </sqlQuery>

     <sqlQuery name="KeepRemove">
          <paramRef ref="participantParams.use_rel_case_control" />  
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
            <![CDATA[
                     SELECT * from (
                     SELECT 'Remove' as display, 'remove' as term, 'MINUS' as internal from dual
                     UNION
                     SELECT 'Keep' as display, 'keep' as term, 'INTERSECT' as internal from dual
                     where $$use_rel_case_control$$ = 1  )
                     ORDER by term desc
            ]]>
            </sql>
        </sqlQuery>

     <sqlQuery name="StudyType">
          <paramRef ref="participantParams.tbl_prefix" />  
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
            <![CDATA[
            ]]>
            SELECT * from (
            SELECT 'Any' as display, 'any' as term, 'any' as internal from dual
            UNION
            select distinct initcap(string_value) as display, string_value as term, string_value as internal
--            from apidbtuning.$$tbl_prefix$$ParticipantMD
            from apidbtuning.Df6c59e88c1ParticipantMD
            where ontology_term_name = 'OBI_0500000'  )
            ORDER by term
            </sql>
        </sqlQuery>

  </querySet>    

      <groupSet name="metaDataGroups">
        
        <group name="daterange" displayName="Time period / age at visit" displayType="ShowHide">
            <description>
                <![CDATA[
Filter participants based on the date range they were observed, the number of days they were observed in that period, and their age at each observation (ie clinical visit). Study data is available from 05-AUG-2011 to 30-JUN-2016.
                ]]>
            </description>
        </group>
        <group name="household_daterange" displayName="Time period" displayType="ShowHide">
            <description>
                <![CDATA[
Filter households based on the date range they were in the study.  Note that the Average Anopheles is computed from monthly CDC light trap collections within this time frame.  
                ]]>
            </description>
        </group>
        <group name="age_at_visit" displayName="Age" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on their age at visits. Participants are removed if they have any visits within the previously selected Time Period where they were not within this Age range.  (The study included participants from age 0.5 to 11 years, and from 18 to 75 years of age.)
                ]]>
            </description>
        </group>
        <group name="lighttrap_characteristics" displayName="Light Trap Collections" displayType="ShowHide">
            <description>
                <![CDATA[
		       Filter light trap collections based on their characteristics.
                ]]>
            </description>
        </group>
        <group name="part_characteristics" displayName="Personal characteristics" displayType="ShowHide">
            <description>
                <![CDATA[
		       Filter participants based on their characteristics that do not change over time.
                ]]>
            </description>
        </group>
        <group name="visit_part_characteristics" displayName="Personal characteristics" displayType="ShowHide">
            <description>
                <![CDATA[
You can restrict visits returned based on participants by selecting characteristics about where they live including their household type and their own characteristics such as genotype information.
                ]]>
            </description>
        </group>
        <group name="part_household_characteristics" displayName="Households" displayType="ShowHide">
            <description></description> <!-- no need for a descrip.  too obvious -->
        </group>
        <group name="geographic_loc" displayName="Geographic region" displayType="ShowHide">
            <description></description> <!-- no need for a descrip.  too obvious -->
        </group>
        <group name="visit_visit_characteristics" displayName="Visits" displayType="ShowHide">
            <description>
                <![CDATA[
You can restrict the observations returned in your search by selecting characteristics such as the type of observation, diagnosis, observation type, etc.
                ]]>
            </description>
        </group>
        <group name="visit_characteristics" displayName="Visits" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter observations based on observations at visits.  Visits shown are from the period when the selected participants meet the age range specified in the Age filter    
             ]]>
            </description>
        </group>
        <group name="event_characteristics" displayName="Observations" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter observations based on information gained at those observations. 
             ]]>
            </description>
        </group>
       <group name="part_visit_characteristics" displayName="Observations" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on observations at visits.  Observations shown are for the selected set of participants when they were within the age range specified in the Age filter.  Change the default values for the Observations per Year parameter to restrict the participants based on your selected observation values.
                ]]>
            </description>
        </group>
        <group name="observ_visit_characteristics" displayName="Observations" displayType="ShowHide">
            <description>
                <![CDATA[
    Observations shown are for the selected set of participants when they were within the age range specified in the Age filter.  Change the default values for the Observations per Year parameter to restrict observations returned based on your selected observation values.
                ]]>
            </description>
        </group>
       <group name="part_event_characteristics" displayName="Observations" displayType="ShowHide">
            <description>
                <![CDATA[
    Filter participants based on information gained at observations.     
                ]]>
            </description>
        </group>
        <group name="summary_params" displayName="Visit aggregates" displayType="ShowHide">
            <description>
                <![CDATA[
You can further restrict the participants returned in your search by setting summary values such as the average parasitemia or the number of visits / year of the visits matching the previous step characteristics.
                ]]>
            </description>
        </group>
        <group name="event_summary_params" displayName="# Observations selected" displayType="ShowHide">
            <description>
                <![CDATA[
You can further restrict the participants returned in your search by setting a range of the number of observations per participant that meet your search criteria. 
                ]]>
            </description>
        </group>
        <group name="relative_visits" displayName="Related Observations" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can further restrict the observations you selected in the previous step by removing (or keeping) those observations based on related observations you define below.  For example, you may want to only keep observations with a diagnosis of asymptomatic parasitemia if they are not followed within 14 days by an observation where the participant was diagnosed with malaria.  In this example, set the days between observations to 1 to 14 and direction to before to remove observations where the related observation diagnosis of malaria = yes.
                ]]>
            </description>
        </group>

        <group name="relative_events" displayName="Related observations" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can restrict the observations you have previously selected by removing (or keeping) those observations based on related observations you define below. For example, you may want to only keep diarrheal observations if they are followed between 0 - 5 days by an observation where a laboratory test was positive for shigella.
                ]]>
            </description>
        </group>

        <group name="relative_case_control" displayName="Related Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         You can restrict the participants you have previously selected by removing (or keeping) participants based on differences or similarities between matched cases and controls. 
                ]]>
            </description>
        </group>

        <group name="results_options" displayName="Results Options" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose whether to return just the participants selected in this search, include the matching cases (or controls) for the participants selected or only the matching cases (or controls) for the selected participants.
                ]]>
            </description>
        </group>
        
        <group name="choose_case_control" displayName="Choose Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose whether to query just cases, just controls or both. 
                ]]>
            </description>
        </group>
 
        <group name="study_arm_case_control" displayName="Study Arm, Case/Control" displayType="ShowHide">
            <description>
                <![CDATA[
                         Choose the study arm and whether to query just cases, just controls or both. 
                ]]>
            </description>
        </group>
 
        <group name="choose_study_type" displayName="Study type" displayType="ShowHide">
            <description>
                <![CDATA[
                         This study contains multiple study types. Choose which study type to include in this search.
                ]]>
            </description>
        </group>

        <group name="treatment" displayName="Treatment" displayType="ShowHide">
            <description>
                <![CDATA[
                         Limit this search based on treatment.
                ]]>
            </description>
        </group>

        <group name="relative_treatment" displayName="Related Treatment" displayType="ShowHide">
            <description>
                <![CDATA[
                         Limit the related observations based on treatment.
                ]]>
            </description>
        </group>

    </groupSet>

</wdkModel>

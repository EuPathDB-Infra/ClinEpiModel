<wdkModel>

  <!-- notes

  -->

  <querySet name="HouseholdId" queryType="id" isCacheable="false">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->


    <!-- TEMPLATE_ANCHOR householdSourceIdQuery -->

    <!-- TEMPLATE_ANCHOR householdMetadataQueryRegion -->
    <!-- TEMPLATE_ANCHOR householdMetadataQueryHousehold -->
    <!-- TEMPLATE_ANCHOR householdMetadataQueryParticipant -->

    <sqlQuery name="HouseholdsByCharacteristics_prism" isCacheable="true">
       <paramRef ref="participantParams.tbl_prefix" visible="false" default="D0ad509829e" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.geographic_region_prism" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.date_range" minDate="2011-07-01" maxDate="2017-07-31" groupRef="metaDataGroups.household_daterange"/>
       <paramRef ref="householdParams.households_prism" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.participants_prism" groupRef="metaDataGroups.part_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
       <column name="ave_anoph"/>
       <column name="part_count"/>
         <sql>
           <![CDATA[
select dwpct.name as source_id, '@PROJECT_ID@' as project_id, 
   round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000193,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as ave_anoph, dwpct.part_count
from (
select da.pan_id,da.name,count(*) as part_count
from ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$Households da
where io.output_pan_id in ($$participants_prism$$)
and da.pan_id = io.input_pan_id
group by da.pan_id,da.name
) dwpct, ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$LightTraps la
  where  dwpct.pan_id = io.input_pan_id
  and la.pan_id = io.output_pan_id
  and EUPATH_0020003 >= $$date_range.min$$
  and EUPATH_0020003 <= $$date_range.max$$ 
  group by dwpct.name,dwpct.part_count
                ]]>   
        </sql>
     </sqlQuery>

    <sqlQuery name="HouseholdsByCharacteristics_prism2" isCacheable="true">
       <paramRef ref="participantParams.tbl_prefix" visible="false" default="D51b40fe2e2" groupRef="metaDataGroups.household_daterange"/>
       <paramRef ref="householdParams.geographic_region_prism" visible="false" groupRef="metaDataGroups.household_daterange"/>
       <paramRef ref="householdParams.date_range"  minDate="2017-09-01" maxDate="2019-12-31" groupRef="metaDataGroups.household_daterange"/>
       <paramRef ref="householdParams.households_prism" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.participants_prism" groupRef="metaDataGroups.part_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
       <column name="ave_anoph"/>
       <column name="part_count"/>
         <sql>
           <![CDATA[
select dwpct.name as source_id, '@PROJECT_ID@' as project_id, 
   round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as ave_anoph, dwpct.part_count
from (
select da.pan_id,da.name,count(*) as part_count
from ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$Households da
where io.output_pan_id in ($$participants_prism$$)
and da.pan_id = io.input_pan_id
group by da.pan_id,da.name
) dwpct, ApidbTuning.$$tbl_prefix$$PANIO io, ApidbTuning.$$tbl_prefix$$LightTraps la
  where  dwpct.pan_id = io.input_pan_id
  and la.pan_id = io.output_pan_id
  and EUPATH_0020003 >= $$date_range.min$$
  and EUPATH_0020003 <= $$date_range.max$$ 
  group by dwpct.name,dwpct.part_count
                ]]>   
        </sql>
     </sqlQuery>

    <sqlQuery name="HouseholdsByCharacteristics_india" isCacheable="true">
       <paramRef ref="participantParams.tbl_prefix" visible="false" default="D05ea525fd3" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.geographic_region_india" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.householdOrObservation" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.households_india" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.participants_india" groupRef="metaDataGroups.part_characteristics"/>
       <paramRef ref="householdParams.observations_india" groupRef="metaDataGroups.part_event_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
       <column name="ave_anoph"/>
       <column name="part_count"/>
         <sql>
           <![CDATA[
select dwpct.name as source_id, '@PROJECT_ID@' as project_id, dwpct.part_count
from (
select da.pan_id,da.name,count(*) as part_count
from ApidbTuning.$$tbl_prefix$$HousePartIO io, ApidbTuning.$$tbl_prefix$$Households da, 
(select distinct household_id, household_observation_id from ApidbTuning.$$tbl_prefix$$HouseholdMD) h
where io.participant_id in ($$observations_india$$)
and io.household_id = h.household_id
and h.$$householdOrObservation$$ in ($$households_india$$)
and da.pan_id = h.$$householdOrObservation$$ 
group by da.pan_id,da.name
) dwpct
                ]]>   
        </sql>
     </sqlQuery>

         <sqlQuery name="HouseholdsByCharacteristicsCS_india" isCacheable="true">
       <paramRef ref="participantParams.tbl_prefix" visible="false" default="Da5c969d5fa" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.geographic_region_india" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.householdOrObservation" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.households_india" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="householdParams.participants_india" groupRef="metaDataGroups.part_characteristics"/>
       <paramRef ref="householdParams.observations_india" groupRef="metaDataGroups.part_event_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
       <column name="ave_anoph"/>
       <column name="part_count"/>
         <sql>
           <![CDATA[
select dwpct.name as source_id, '@PROJECT_ID@' as project_id, dwpct.part_count
from (
select da.pan_id,da.name,count(*) as part_count
from ApidbTuning.$$tbl_prefix$$HousePartIO io, ApidbTuning.$$tbl_prefix$$Households da, 
(select distinct household_id, household_observation_id from ApidbTuning.$$tbl_prefix$$HouseholdMD) h
where io.participant_id in ($$observations_india$$)
and io.household_id = h.household_id
and h.$$householdOrObservation$$ in ($$households_india$$)
and da.pan_id = h.$$householdOrObservation$$ 
group by da.pan_id,da.name
) dwpct
                ]]>   
        </sql>
     </sqlQuery>




<!-- transform(s) -->

    <!-- TEMPLATE_ANCHOR householdsByParticipantQuery -->

    <!-- TEMPLATE_ANCHOR householdsByLightTrapsQuery  -->


  </querySet>
</wdkModel>

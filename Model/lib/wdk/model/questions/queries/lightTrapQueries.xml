<wdkModel>

  <!-- notes-->

  <querySet name="LightTrapId" queryType="id" isCacheable="false" excludeProjects="TrichDB">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

     <sqlQuery name="LightTrapDataByMetadataCross"
         isCacheable="true">
      <paramRef ref="participantParams.start_date"/>
      <paramRef ref="participantParams.end_date"/>
      <paramRef ref="lighttrapParams.lighttraps_by_all_metadata" />
      <column name="source_id"/>
      <column name="project_id"/>
      <column name="ave_num_anoph"/>
        <sql>
          <![CDATA[
     select lta.source_id, round(avg(SUM_FEMALE_AS_IN_A_COLLECTION),1) as ave_num_anoph
       from apidbtuning.lighttrapattributes lta, apidbtuning.dwellingattributes da
       where lta.source_id in  ($$lighttraps_by_all_metadata$$)
       and da.source_id = lta.parent_id(+)
       and lta.collection_date(+) >= to_date($$start_date$$, 'DD-MON-YYYY')
       and lta.collection_date(+) <= to_date($$end_date$$, 'DD-MON-YYYY')
       group by lta.source_id, da.subcounty_in_uganda
            ]]>
       </sql>
    </sqlQuery>


    <sqlQuery name="CollectionsBySourceID"
	      isCacheable="true">
      <paramRef ref="lighttrapParams.collectionsBySourceID" />
      <column name="source_id" />
      <column name="project_id" />
      <sql>

	<![CDATA[select distinct lta.name, '@PROJECT_ID@' as project_id from APIDBTUNING.LIGHTTRAPATTRIBUTES lta,
        ($$collectionsBySourceID$$) ds WHERE lta.name = ds.source_id]]>
      </sql>
    </sqlQuery>
      
    <sqlQuery name="LightTrapsByDwellingIds" doNotTest="true" displayName="ID" isCacheable="true">
    <paramRef ref="dwellingParams.dwelling_result"/>
        <column name="project_id"/>
        <column name="source_id"/>
        <column name="wdk_weight"/>

        <sql>
            <![CDATA[
SELECT   lta.name as source_id , '@PROJECT_ID@' as project_id, da.name as dwelling, wdk_weight
              FROM ($$dwelling_result$$) source_set, ApidbTuning.protocolappnodeio io, apidbtuning.dwellingattributes da, apidbtuning.lighttrapattributes lta
              WHERE source_set.source_id = da.name 
              AND da.protocol_app_node_id = io.input_node_id
              AND  io.output_node_id = lta.protocol_app_node_id
             ]]>
        </sql>
    </sqlQuery>
 
  </querySet>
</wdkModel>

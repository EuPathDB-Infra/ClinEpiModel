<wdkModel>

  <!-- notes-->

  <querySet name="LightTrapId" queryType="id" isCacheable="false">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="CollectionsBySourceID"
	      isCacheable="true">
      <paramRef ref="lightTrapParams.collectionsBySourceID" />
      <column name="source_id" />
      <column name="project_id" />
      <sql>

	<![CDATA[select distinct lta.name as source_id, '@PROJECT_ID@' as project_id from APIDBTUNING.LIGHTTRAPATTRIBUTES lta,
        ($$collectionsBySourceID$$) ds WHERE lta.name = ds.source_id]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="LightTrapsByCharacteristics"
              isCacheable="true">
       <paramRef ref="participantParams.dataset" visible="false" default="ISASimple_ICEMR_PRISM_surveillance_RSRC"/>
       <paramRef ref="lightTrapParams.geographic_region" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="householdParams.date_range" groupRef="metaDataGroups.household_daterange"/>
       <paramRef ref="lightTrapParams.households_nf" groupRef="metaDataGroups.part_household_characteristics"/>
       <paramRef ref="lightTrapParams.lighttraps_nf" groupRef="metaDataGroups.lighttrap_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
         <sql>
           <![CDATA[
select lta.name as source_id, '@PROJECT_ID@' as project_id
from apidbtuning.lighttrapattributes lta
where lta.protocol_app_node_id in ($$lighttraps_nf$$)
                ]]>   
        </sql>
     </sqlQuery>


    <!-- Transforms -->
      
    <sqlQuery name="LightTrapsByHouseholdIds" doNotTest="true" displayName="ID" isCacheable="true">
    <paramRef ref="householdParams.household_result"/>
        <column name="project_id"/>
        <column name="source_id"/>
        <column name="wdk_weight"/>

        <sql>
            <![CDATA[
SELECT   lta.name as source_id , '@PROJECT_ID@' as project_id, da.name as household, wdk_weight
              FROM ($$household_result$$) source_set, apidbtuning.PANIO io, apidbtuning.householdattributes da, apidbtuning.lighttrapattributes lta
              WHERE source_set.source_id = da.name 
              AND da.protocol_app_node_id = io.input_pan_id
              AND  io.output_pan_id = lta.protocol_app_node_id
             ]]>
        </sql>
    </sqlQuery>
 
  </querySet>
</wdkModel>

<wdkModel>

  <!-- notes-->

  <querySet name="LightTrapId" queryType="id" isCacheable="false">

    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
    <!-- Source id  -->
    <!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

    <sqlQuery name="CollectionsBySourceID"
	      isCacheable="true">
      <paramRef ref="lightTrapParams.collectionsBySourceID" />
      <column name="source_id" />
      <column name="project_id" />
      <sql>

	<![CDATA[select distinct lta.name as source_id, '@PROJECT_ID@' as project_id from APIDBTUNING.LIGHTTRAPATTRIBUTES lta,
        ($$collectionsBySourceID$$) ds WHERE lta.name = ds.source_id]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="LightTrapsByCharacteristics"
              isCacheable="true">
       <paramRef ref="lightTrapParams.geographic_region" groupRef="metaDataGroups.geographic_loc"/>
       <paramRef ref="participantParams.start_date" groupRef="metaDataGroups.daterange"/>
       <paramRef ref="participantParams.end_date" groupRef="metaDataGroups.daterange"/>
       <paramRef ref="lightTrapParams.dwellings_nf" groupRef="metaDataGroups.part_dwelling_characteristics"/>
       <paramRef ref="lightTrapParams.lighttraps_nf" groupRef="metaDataGroups.lighttrap_characteristics"/>
       <column name="source_id"/>
       <column name="project_id"/>
         <sql>
           <![CDATA[
select lta.name as source_id, 'ClinEpiDB' as project_id
from apidbtuning.lighttrapattributes lta
where lta.protocol_app_node_id in ($$lighttraps_nf$$)
                ]]>   
        </sql>
     </sqlQuery>


    <!-- Transforms -->
      
    <sqlQuery name="LightTrapsByDwellingIds" doNotTest="true" displayName="ID" isCacheable="true">
    <paramRef ref="dwellingParams.dwelling_result"/>
        <column name="project_id"/>
        <column name="source_id"/>
        <column name="wdk_weight"/>

        <sql>
            <![CDATA[
SELECT   lta.name as source_id , '@PROJECT_ID@' as project_id, da.name as dwelling, wdk_weight
              FROM ($$dwelling_result$$) source_set, ApidbTuning.protocolappnodeio io, apidbtuning.dwellingattributes da, apidbtuning.lighttrapattributes lta
              WHERE source_set.source_id = da.name 
              AND da.protocol_app_node_id = io.input_node_id
              AND  io.output_node_id = lta.protocol_app_node_id
             ]]>
        </sql>
    </sqlQuery>
 
  </querySet>
</wdkModel>

[templateStart]
name=participantFilterParams
anchorFile=ClinEpiModel/Model/lib/wdk/model/questions/params/participantParams.xml
prop=injectedTemplateFull
>templateTextStart<
${injectedTemplateFull}
>templateTextEnd<

[templateStart]
name=participantFilterParamsRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdFilterDataTypeDisplayName
>templateTextStart<
        <flatVocabParam name="study_arm_${tblPrefix}"
               prompt="Study Arm"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef=""
               queryRef="ParticipantVQ.StudyArm_${tblPrefix}">
      <help>You may choose to limit your search to a specific study arm.</help>
    </flatVocabParam>

       <filterParam name="geographic_region_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.RegionOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.RegionMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.RegionMetaDataBkg_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="Households"
                    prompt="Geographic region"
                    dependedParamRef="participantParams.study_arm_${tblPrefix}"
                    trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
       </filterParam>
       
       <filterParam name="households_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="${householdFilterDataTypeDisplayName}"
                    prompt="Households"
                    dependedParamRef="participantParams.geographic_region_${tblPrefix}"
                    trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
       </filterParam>

       <filterParam name="participants_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="Participants"
                    prompt="Personal characteristics"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.households_${tblPrefix}">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.participants_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
 
       <filterParam name="relative_visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
         <help>
           Select related observations based on their characteristics. 
         </help>
       </filterParam>

>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
        <sqlQuery name="StudyArm_${tblPrefix}">
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
         <![CDATA[
SELECT * from (
SELECT 'Any Study Arm' as display, 'AnY' as term, 'AnY' as internal, 1 as ordernum from dual
UNION
select distinct initcap(string_value) as display, string_value as term, string_value as internal, 2 as ordernum
from apidbtuning.${tblPrefix}ParticipantMD
where ontology_term_name = 'EUPATH_0015457')
order by ordernum,display
            ]]>
            </sql>
        </sqlQuery>

   <sqlQuery name="RegionOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.study_arm_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
and ('AnY' = \$\$study_arm_${tblPrefix}\$\$
       or hp.participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and string_value = \$\$study_arm_${tblPrefix}\$\$))
        ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="RegionMetaDataBkg_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${householdMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name not in (${householdFilterExcludedIdsQuoted})
     ${rmRegionSqlCommentStart}
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
     ${rmRegionSqlCommentEnd}
     order by display_order, display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_${tblPrefix}" isCacheable="false">
     <paramRef ref="participantParams.geographic_region_${tblPrefix}" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where hp.household_id in (\$\$geographic_region_${tblPrefix}\$\$)
and h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in (${participantFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
     <paramRef ref="participantParams.households_${tblPrefix}" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where participant_id in (\$\$households_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.participants_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<


[templateStart]
name=participantFilterParamsHousehold
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdFilterDataTypeDisplayName
>templateTextStart<
        <flatVocabParam name="study_arm_${tblPrefix}"
               prompt="Study Arm"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef=""
               queryRef="ParticipantVQ.StudyArm_${tblPrefix}">
      <help>You may choose to limit your search to a specific study arm.</help>
    </flatVocabParam>

       <filterParam name="households_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkg_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="${householdFilterDataTypeDisplayName}"
                    prompt="Households"
                    dependedParamRef="participantParams.study_arm_${tblPrefix}"
                    trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
       </filterParam>

       <filterParam name="participants_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="Participants"
                    prompt="Personal characteristics"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.households_${tblPrefix}">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.participants_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
 
       <filterParam name="relative_visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
         <help>
           Select related observations based on their characteristics. 
         </help>
       </filterParam>

>templateTextEnd<

[templateStart]
name=participantFilterParamQueries
anchorFile=ClinEpiModel/Model/lib/wdk/model/questions/params/participantParams.xml
prop=injectedTemplateFull
>templateTextStart<
${injectedTemplateFull}
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesHousehold
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentEnd
>templateTextStart<
        <sqlQuery name="StudyArm_${tblPrefix}">
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
         <![CDATA[
SELECT * from (
SELECT 'Any Study Arm' as display, 'AnY' as term, 'AnY' as internal, 1 as ordernum from dual
UNION
select distinct initcap(string_value) as display, string_value as term, string_value as internal, 2 as ordernum
from apidbtuning.${tblPrefix}ParticipantMD
where ontology_term_name = 'EUPATH_0015457')
order by ordernum,display
            ]]>
            </sql>
        </sqlQuery>

   <sqlQuery name="HouseholdOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${householdMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name not in (${householdFilterExcludedIdsQuoted})
     order by display_order, display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.study_arm_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
and ('AnY' = \$\$study_arm_${tblPrefix}\$\$
       or hp.participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and string_value = \$\$study_arm_${tblPrefix}\$\$))
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdMetaDataBkg_${tblPrefix}" isCacheable="false">
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in (${participantFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
     <paramRef ref="participantParams.households_${tblPrefix}" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where participant_id in (\$\$households_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.participants_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<


[templateStart]
name=participantFilterParamsParticipant
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
        <flatVocabParam name="study_arm_${tblPrefix}"
               prompt="Study Arm"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef=""
               queryRef="ParticipantVQ.StudyArm_${tblPrefix}">
      <help>You may choose to limit your search to a specific study arm.</help>
    </flatVocabParam>

       <filterParam name="participants_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkg_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    filterDataTypeDisplayName="Participants"
                    prompt="Personal characteristics"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.study_arm_${tblPrefix}">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.participants_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
 
       <filterParam name="relative_visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
         <help>
           Select related observations based on their characteristics. 
         </help>
       </filterParam>

>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesParticipant
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
>templateTextStart<
        <sqlQuery name="StudyArm_${tblPrefix}">
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
         <![CDATA[
SELECT * from (
SELECT 'Any Study Arm' as display, 'AnY' as term, 'AnY' as internal, 1 as ordernum from dual
UNION
select distinct initcap(string_value) as display, string_value as term, string_value as internal, 2 as ordernum
from apidbtuning.${tblPrefix}ParticipantMD
where ontology_term_name = 'EUPATH_0015457')
order by ordernum,display
            ]]>
            </sql>
        </sqlQuery>

   <sqlQuery name="ParticipantOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted},${householdMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000096','PCO_0000024')
     )
     where ontology_term_name not in (${participantFilterExcludedIdsQuoted},${householdFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.study_arm_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where ('AnY' = \$\$study_arm_${tblPrefix}\$\$
       or participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and string_value = \$\$study_arm_${tblPrefix}\$\$))
UNION
select hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
and ('AnY' = \$\$study_arm_${tblPrefix}\$\$
       or hp.participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and string_value = \$\$study_arm_${tblPrefix}\$\$))
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantMetaDataBkg_${tblPrefix}" isCacheable="false">
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
UNION
select hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.participants_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<


[templateStart]
name=participantFilterParamsWithTreatment
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
       <filterParam name="participants_${tblPrefix}" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.VisitMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                       countPredictsAnswerCount="true"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.participants_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

       <filterParam name="treatment_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.TreatmentOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.TreatmentMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.TreatmentMetaDataBkgd_${tblPrefix}"
                       countPredictsAnswerCount="true"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.visits_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>

    <filterParam name="relative_visits_${tblPrefix}" 
                    metadataQueryRef="ParticipantVQ.RelVisitMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.RelVisitMetaData_${tblPrefix}"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    prompt="Related Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
      <help>
        Select related observations based on their characteristics. 
      </help>
    </filterParam>

       <filterParam name="relative_treatment_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.TreatmentOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.RelativeTreatmentMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.TreatmentMetaDataBkgd_${tblPrefix}"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.relative_visits_${tblPrefix}">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesWithTreatment
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
>templateTextStart<
   <sqlQuery name="ParticipantOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
     UNION
     select distinct ontology_term_source_id as ontology_term_name, 'EUPATH_0000096' as parent_ontology_term_name, nvl(display_name,ontology_term_name) as display_name, description, units,type,is_range,precision, 0.5 as display_order
     from ApidbTuning.${tblPrefix}Ontology 
     where ontology_term_source_id = 'EUPATH_0021095'
     )
     where ontology_term_name != 'EUPATH_0000095'
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where participant_id not in ('29082466','29082990')
UNION
select  distinct household_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}HouseholdMD 
where household_id not in ('29082466','29082990')
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="VisitOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
     and ontology_term_name not in (select distinct ontology_term_name
from ApidbTuning.${tblPrefix}ObservationMD
where sub_observation_id in (select distinct sub_observation_id from ApidbTuning.${tblPrefix}ObsObsIO))
     order by display_order,display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.participants_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_${tblPrefix}\$\$)
and sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.${tblPrefix}ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.${tblPrefix}ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="TreatmentOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
o.type, o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}ObservationMD md, ApidbTuning.${tblPrefix}Ontology o
where md.sub_observation_id in (select distinct sub_observation_id from ApidbTuning.${tblPrefix}ObsObsIO)
and o.ontology_term_source_id = Md.Ontology_Term_Name)
order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="TreatmentMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.visits_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="filter_item_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where observation_id in (\$\$visits_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="TreatmentMetaDataBkgd_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="RelVisitMetaData_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where sub_observation_id not in (select distinct sub_observation_id from ApidbTuning.${tblPrefix}ObsObsIO)
          ]]>
    </sql>
    </sqlQuery>
   
       <sqlQuery name="RelativeTreatmentMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.relative_visits_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="filter_item_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where observation_id in (\$\$relative_visits_${tblPrefix}\$\$)
          ]]>
    </sql>
    </sqlQuery>    
>templateTextEnd<

[templateStart]
name=participantFilterParamsCaseControlRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdFilterDataTypeDisplayName
>templateTextStart<
        <flatVocabParam name="study_arm_${tblPrefix}"
               prompt="Study Arm"
               multiPick="false"
               quote="true"
               visible="true"
               dependedParamRef=""
               queryRef="ParticipantVQ.StudyArm_${tblPrefix}">
      <help>You may choose to limit your search to a specific study arm.</help>
    </flatVocabParam>

       <filterParam name="geographic_region_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.GeographicRegionOntology_${tblPrefix}" 
                       metadataQueryRef="ParticipantVQ.GeographicRegionMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.GeographicRegionMetaDataBkg_${tblPrefix}"
                       filterDataTypeDisplayName="Participants"
                       prompt="Study Site"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.case_control,participantParams.study_arm_${tblPrefix}">
         <help>
           Select participants based on their study site.
         </help>
       </filterParam>

       <filterParam name="household_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkg_${tblPrefix}"
                       filterDataTypeDisplayName="${householdFilterDataTypeDisplayName}"
                       prompt="Household"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.geographic_region_${tblPrefix}">
         <help>
           Select participants based on household characteristics. 
         </help>
       </filterParam>
       
       <filterParam name="participant_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkg_${tblPrefix}"
                       filterDataTypeDisplayName="Participants"
                       prompt="Participant"
                       trimMetadataTerms="false"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.household_${tblPrefix}">
         <help>
           Select participants based on their personal characteristics. 
         </help>
       </filterParam>

       <filterParam name="event_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.ObservationMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_${tblPrefix}"
                       filterDataTypeDisplayName="Observations"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.participant_${tblPrefix}">
         <help>
           Select participants based on variables associated with their enrollment or followup events. 
         </help>
       </filterParam>       

      <filterParam name="relative_event_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.RelativeCasecontrolObservationMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_${tblPrefix}"
                       filterDataTypeDisplayName="Observations"
                       prompt="Related Case or Control"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.case_control">
         <help>
           Modify participants selected based on information about their related case or control. 
         </help>
       </filterParam>    
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesCaseControlRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
        <sqlQuery name="StudyArm_${tblPrefix}">
          <column name="display" />
          <column name="internal" />
          <column name="term" />
          <sql>
         <![CDATA[
SELECT * from (
SELECT 'Any Study Arm' as display, 'AnY' as term, 'AnY' as internal, 1 as ordernum from dual
UNION
select distinct initcap(string_value) as display, string_value as term, string_value as internal, 2 as ordernum
from apidbtuning.${tblPrefix}ParticipantMD
where ontology_term_name = 'EUPATH_0015457')
order by ordernum,display
            ]]>
            </sql>
        </sqlQuery>

    <sqlQuery name="GeographicRegionOntology_${tblPrefix}">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
     order by display_order, display_name
          ]]>
      </sql>
    </sqlQuery>

    <sqlQuery name="GeographicRegionMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.case_control" />  
      <paramRef ref="participantParams.study_arm_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.ontology_term_name in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and m.household_id = hp.household_id 
and hp.participant_id in (select pan_id
       from ApidbTuning.${tblPrefix}Participants
       where lower(EUPATH_0010375) in (\$\$case_control\$\$))
and ('AnY' = \$\$study_arm_${tblPrefix}\$\$
       or hp.participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and string_value = \$\$study_arm_${tblPrefix}\$\$))
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="GeographicRegionMetaDataBkg_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.ontology_term_name = 'OBI_0001627'
and m.household_id = hp.household_id  
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="HouseholdOntology_${tblPrefix}">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in (${householdMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'PCO_0000024'
) where ontology_term_name not in (${householdFilterExcludedIdsQuoted})
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                  select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where hp.household_id in (\$\$geographic_region_${tblPrefix}\$\$)
and m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkg_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantOntology_${tblPrefix}">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
) where ontology_term_name not in (${participantFilterExcludedIdsQuoted})
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.household_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
where m.participant_id in (\$\$household_${tblPrefix}\$\$)
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkg_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationOntology_${tblPrefix}">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
) where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ObservationMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.participant_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participant_${tblPrefix}\$\$)
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationMetaDataBkg_${tblPrefix}" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="RelativeCasecontrolObservationMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="participantParams.case_control" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (select pan_id
       from ApidbTuning.${tblPrefix}Participants
       where lower(EUPATH_0010375) not in (\$\$case_control\$\$) )
          ]]>
    </sql>    
    </sqlQuery>
>templateTextEnd<

[templateStart]
name=participantFilterParamsPRISM
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
       <filterParam name="geographic_region_prism" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_prism"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_prism"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_prism"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       countPredictsAnswerCount="true"
                       trimMetadataTerms="true"
                       dependedParamRef="">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="visits_visitage_metadata_prism" 
                    ontologyQueryRef="ParticipantVQ.VisitAgeOntology_prism"
                    metadataQueryRef="ParticipantVQ.VisitAgeMetaData_prism"
                    backgroundQueryRef="ParticipantVQ.VisitAgeMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Age at visit"
                    filterDataTypeDisplayName="Participants"
                    dependedParamRef="participantParams.geographic_region_prism"
                    trimMetadataTerms="true">
      <help>
        Select reference samples. 
      </help>
    </filterParam>
    
    <filterParam name="participants_prism" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_prism"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_prism"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_prism"
                    countPredictsAnswerCount="true"
                    prompt="Participants"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.visits_visitage_metadata_prism,clinicalVisitParams.visit_date,participantParams.duration_observation,participantParams.geographic_region_prism">
      <help>
        Select participants based on their characteristics. 
      </help>
    </filterParam>


    <filterParam name="households_prism" 
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_prism"
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_prism"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_prism"
                    filterDataTypeDisplayName="Households"
                    countPredictsAnswerCount="true"
                    prompt="Households"
                    dependedParamRef="clinicalVisitParams.visit_date,participantParams.participants_prism"
                    trimMetadataTerms="true">
      <help>
        Select participants based on the characteristics of the household where they live. 
      </help>
    </filterParam>

    <filterParam name="visits_prism" 
                    metadataQueryRef="ParticipantVQ.VisitMetaData_prism"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_prism"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.visits_visitage_metadata_prism,participantParams.households_prism,clinicalVisitParams.visit_date">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>

        <filterParam name="relative_visits_prism" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_prism"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_prism"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>
>templateTextEnd<

[templateStart]
name=participantFilterParamsEntomolRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdFilterDataTypeDisplayName
>templateTextStart<
       <filterParam name="geographic_region_${tblPrefix}" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_${tblPrefix}"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_${tblPrefix}"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_${tblPrefix}"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       countPredictsAnswerCount="true"
                       trimMetadataTerms="true"
                       dependedParamRef="">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="visits_visitage_metadata_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitAgeOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitAgeMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitAgeMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Age at visit"
                    filterDataTypeDisplayName="Participants"
                    dependedParamRef="participantParams.geographic_region_${tblPrefix}"
                    trimMetadataTerms="true">
      <help>
        Select reference samples. 
      </help>
    </filterParam>
    
    <filterParam name="participants_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.ParticipantOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.ParticipantMetaData_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="true"
                    prompt="Participants"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.visits_visitage_metadata_${tblPrefix},clinicalVisitParams.visit_date,participantParams.duration_observation,participantParams.geographic_region_${tblPrefix}">
      <help>
        Select participants based on their characteristics. 
      </help>
    </filterParam>


    <filterParam name="households_${tblPrefix}" 
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_${tblPrefix}"
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_${tblPrefix}"
                    filterDataTypeDisplayName="Households"
                    countPredictsAnswerCount="true"
                    prompt="Households"
                    dependedParamRef="clinicalVisitParams.visit_date,participantParams.participants_${tblPrefix}"
                    trimMetadataTerms="true">
      <help>
        Select participants based on the characteristics of the household where they live. 
      </help>
    </filterParam>

    <filterParam name="visits_${tblPrefix}" 
                    metadataQueryRef="ParticipantVQ.VisitMetaData_${tblPrefix}"
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="participantParams.visits_visitage_metadata_${tblPrefix},participantParams.households_${tblPrefix},clinicalVisitParams.visit_date">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>

        <filterParam name="relative_visits_${tblPrefix}" 
                    ontologyQueryRef="ParticipantVQ.VisitOntology_${tblPrefix}"
                    metadataQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_${tblPrefix}"
                    countPredictsAnswerCount="false"
                    prompt="Observations"
                    trimMetadataTerms="true"
                    dependedParamRef="">
      <help>
        Select participants based on their visit characteristics. 
      </help>
    </filterParam>
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesPRISM
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
   <sqlQuery name="RegionOntology_prism" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
where ontology_term_source_id = 'EUPATH_0000054'
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_prism" isCacheable="false" >
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
  select m.household_id as filter_item_id,  io.participant_id as internal, m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO io
 where m.ontology_term_name = 'EUPATH_0000054'
 and io.household_id = m.household_id
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitAgeOntology_prism" isCacheable="true">
         <column name="ontology_term_name"/>
         <column name="parent_ontology_term_name"/>
         <column name="display_name"/>
         <column name="description"/>
         <column name="type"/>
         <column name="units"/>
         <column name="precision"/>
         <column name="is_range"/>
         <sql>
           <![CDATA[
                       select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
where ontology_term_source_id = 'EUPATH_0000113'
    ]]>   
        </sql>
      </sqlQuery>
          
      <sqlQuery name="VisitAgeMetaData_prism" isCacheable="false">
        <paramRef ref="participantParams.geographic_region_prism" /> 
        <column name="ontology_term_name"/>
        <column name="internal"/>
        <column name="number_value"/>
        <column name="date_value"/>
        <column name="string_value"/>
        <sql>
          <![CDATA[
 select m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from  ApidbTuning.${tblPrefix}ObservationMD m
  where m.participant_id in (\$\$geographic_region_prism\$\$)
  and m.ontology_term_name = 'EUPATH_0000113'
         ]]>   
      </sql>
   </sqlQuery>

      <sqlQuery name="VisitAgeMetaDataBkgd_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
  select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ObservationMD m
where m.ontology_term_name = 'EUPATH_0000113'
          ]]>   
      </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantOntology_prism" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
) order by display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_prism" isCacheable="false">
     <paramRef ref="participantParams.visits_visitage_metadata_prism" />
     <paramRef ref="clinicalVisitParams.visit_date" /> 
     <paramRef ref="participantParams.duration_observation" />  
     <paramRef ref="participantParams.geographic_region_prism" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
select distinct m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
  from (select min(EUPATH_0000113) as min_age, max(EUPATH_0000113) as max_age
   from ApidbTuning.${tblPrefix}Observations 
   where pan_id in (\$\$visits_visitage_metadata_prism\$\$)
   ) age,
   ApidbTuning.${tblPrefix}Participants pa, ApidbTuning.${tblPrefix}PartObsIO iov, ApidbTuning.${tblPrefix}ParticipantMD m, ApidbTuning.${tblPrefix}Observations obs
   where least(pa.EUPATH_0000152, \$\$visit_date.max\$\$, pa.EFO_0004950 + ( age.max_age * 365)) - 
       greatest(pa.EUPATH_0000151, \$\$visit_date.min\$\$, pa.EFO_0004950 + ( age.min_age * 365)) + 1 >= \$\$duration_observation\$\$
       and obs.pan_id in (\$\$visits_visitage_metadata_prism\$\$)
       and obs.EUPATH_0000091 >= \$\$visit_date.min\$\$ 
       and obs.EUPATH_0000091 <= \$\$visit_date.max\$\$ 
       and iov.observation_id = obs.pan_id
       and pa.pan_id = iov.participant_id
       and pa.pan_id = m.participant_id       
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select distinct m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdOntology_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000144') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('PCO_0000024','ENVO_01000744')
 union
 select 'average_anopheles' as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, 'Average Female Anopheles Collected' as display_name, 'Average number of female Anopheles mosquitoes collected per house per night using CDC light traps set up once a month during the dates of this search' as description, null as units, 'number' as type, 1 as is_range,
 null as precision from dual)
 where ontology_term_name not in ('EUPATH_0000094')
 order by display_name
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_prism" isCacheable="false">
      <paramRef ref="clinicalVisitParams.visit_date" /> 
      <paramRef ref="participantParams.participants_prism" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from  ApidbTuning.${tblPrefix}PANIO io
   where io.output_pan_id in (\$\$participants_prism\$\$)
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}MetaData m, part
 where part.household_id = m.pan_id
 union all
 select distinct part.household_id as filter_item_id, part.part_id as internal, 'average_anopheles' as ontology_term_name, null as string_value, nvl(mos.avg_anoph,0) as number_value, null as date_value
 from (select da.pan_id, round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as avg_anoph
  from ApidbTuning.${tblPrefix}Households da, ApidbTuning.${tblPrefix}PANIO io, ApidbTuning.${tblPrefix}LightTraps la
  where da.pan_id = io.input_pan_id
  and la.pan_id = io.output_pan_id
  and la.EUPATH_0020003 >= \$\$visit_date.min\$\$ 
  and la.EUPATH_0020003 <= \$\$visit_date.max\$\$ 
  group by da.pan_id) mos, part
  where part.household_id = mos.pan_id(+)
          ]]>
    </sql>    

    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
  with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from ApidbTuning.${tblPrefix}PANIO io
   where io.output_pan_type_source_id = 'EUPATH_0000096'
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}MetaData m, part
 where part.household_id = m.pan_id
 union all
 select distinct part.household_id as filter_item_id, part.part_id as internal, 'average_anopheles' as ontology_term_name, null as string_value, nvl(mos.avg_anoph,0) as number_value, null as date_value
 from (select io.input_pan_id as pan_id, round(avg(nvl(EUPATH_0000192,0)+nvl(EUPATH_0000204,0)+nvl(EUPATH_0000205,0)),1) as avg_anoph
  from ApidbTuning.${tblPrefix}PANIO io, ApidbTuning.${tblPrefix}LightTraps la
  where io.input_pan_type_source_id = 'PCO_0000024'
  and io.output_pan_type_source_id = 'EUPATH_0000327'
  and la.pan_id = io.output_pan_id
  group by io.input_pan_id) mos, part
  where part.household_id = mos.pan_id(+)
          ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="VisitOntology_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
        <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0021002') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name != 'EFO_0004950'
     order by display_name
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitMetaData_prism" isCacheable="false">
         <paramRef ref="participantParams.visits_visitage_metadata_prism" />
         <paramRef ref="clinicalVisitParams.visit_date" /> 
         <paramRef ref="participantParams.households_prism" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
with valid as (
select distinct io.output_pan_id as visit_id, io.input_pan_id as part_id
from ApidbTuning.${tblPrefix}PANIO io, ApidbTuning.${tblPrefix}Observations obs
where io.input_pan_id in (\$\$households_prism\$\$)
and io.output_pan_id in (\$\$visits_visitage_metadata_prism\$\$)
and obs.pan_id = io.output_pan_id
and obs.EUPATH_0000091 >= \$\$visit_date.min\$\$ 
and obs.EUPATH_0000091 <= \$\$visit_date.max\$\$ 
)
select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}ObservationMD m, valid
 where m.observation_id = valid.visit_id
/*
  union all
 select valid.visit_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}MetaData m, valid, ApidbTuning.${tblPrefix}PANIO ios
where m.property_source_id = 'OBI_0100051'
and ios.output_pan_id = m.pan_id
and ios.input_pan_id = valid.visit_id
*/
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_prism" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesEntomolRegion
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
   <sqlQuery name="RegionOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
where ontology_term_source_id = 'EUPATH_0000054'
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_${tblPrefix}" isCacheable="false" >
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
  select m.household_id as filter_item_id,  io.participant_id as internal, m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO io
 where m.ontology_term_name = 'EUPATH_0000054'
 and io.household_id = m.household_id
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitAgeOntology_${tblPrefix}" isCacheable="true">
         <column name="ontology_term_name"/>
         <column name="parent_ontology_term_name"/>
         <column name="display_name"/>
         <column name="description"/>
         <column name="type"/>
         <column name="units"/>
         <column name="precision"/>
         <column name="is_range"/>
         <sql>
           <![CDATA[
                       select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
where ontology_term_source_id = 'EUPATH_0000113'
    ]]>   
        </sql>
      </sqlQuery>
          
      <sqlQuery name="VisitAgeMetaData_${tblPrefix}" isCacheable="false">
        <paramRef ref="participantParams.geographic_region_${tblPrefix}" /> 
        <column name="ontology_term_name"/>
        <column name="internal"/>
        <column name="number_value"/>
        <column name="date_value"/>
        <column name="string_value"/>
        <sql>
          <![CDATA[
 select m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from  ApidbTuning.${tblPrefix}ObservationMD m
  where m.participant_id in (\$\$geographic_region_${tblPrefix}\$\$)
  and m.ontology_term_name = 'EUPATH_0000113'
         ]]>   
      </sql>
   </sqlQuery>

      <sqlQuery name="VisitAgeMetaDataBkgd_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
  select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ObservationMD m
where m.ontology_term_name = 'EUPATH_0000113'
          ]]>   
      </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantOntology_${tblPrefix}" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
) order by display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_${tblPrefix}" isCacheable="false">
     <paramRef ref="participantParams.visits_visitage_metadata_${tblPrefix}" />
     <paramRef ref="clinicalVisitParams.visit_date" /> 
     <paramRef ref="participantParams.duration_observation" />  
     <paramRef ref="participantParams.geographic_region_${tblPrefix}" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
select distinct m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
  from (select min(EUPATH_0000113) as min_age, max(EUPATH_0000113) as max_age
   from ApidbTuning.${tblPrefix}Observations 
   where pan_id in (\$\$visits_visitage_metadata_${tblPrefix}\$\$)
   ) age,
   ApidbTuning.${tblPrefix}Participants pa, ApidbTuning.${tblPrefix}PartObsIO iov, ApidbTuning.${tblPrefix}ParticipantMD m, ApidbTuning.${tblPrefix}Observations obs
   where least(pa.EUPATH_0000152, \$\$visit_date.max\$\$, pa.EFO_0004950 + ( age.max_age * 365)) - 
       greatest(pa.EUPATH_0000151, \$\$visit_date.min\$\$, pa.EFO_0004950 + ( age.min_age * 365)) + 1 >= \$\$duration_observation\$\$
       and obs.pan_id in (\$\$visits_visitage_metadata_${tblPrefix}\$\$)
       and obs.EUPATH_0000091 >= \$\$visit_date.min\$\$ 
       and obs.EUPATH_0000091 <= \$\$visit_date.max\$\$ 
       and iov.observation_id = obs.pan_id
       and pa.pan_id = iov.participant_id
       and pa.pan_id = m.participant_id       
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select distinct m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${householdMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name not in (${householdFilterExcludedIdsQuoted})
     ${rmRegionSqlCommentStart}
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
     ${rmRegionSqlCommentEnd}
     order by display_order, display_name
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_${tblPrefix}" isCacheable="false">
      <paramRef ref="clinicalVisitParams.visit_date" /> 
      <paramRef ref="participantParams.participants_${tblPrefix}" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from  ApidbTuning.${tblPrefix}PANIO io
   where io.output_pan_id in (\$\$participants_${tblPrefix}\$\$)
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}MetaData m, part
 where part.household_id = m.pan_id
          ]]>
    </sql>    

    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
  with part as ( select distinct io.input_pan_id as household_id, io.output_pan_id as part_id
  from ApidbTuning.${tblPrefix}PANIO io
   where io.output_pan_type_source_id = 'EUPATH_0000096'
       and io.input_pan_type_source_id = 'PCO_0000024' )
 select distinct m.pan_id as filter_item_id, part.part_id as internal, m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}MetaData m, part
 where part.household_id = m.pan_id
          ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="VisitOntology_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
        <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in (${observationMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in (${observationFilterExcludedIdsQuoted})
     order by display_name
        ]]>
      </sql>
    </sqlQuery>

       <sqlQuery name="VisitMetaData_${tblPrefix}" isCacheable="false">
         <paramRef ref="participantParams.visits_visitage_metadata_${tblPrefix}" />
         <paramRef ref="clinicalVisitParams.visit_date" /> 
         <paramRef ref="participantParams.households_${tblPrefix}" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
with valid as (
select distinct io.output_pan_id as visit_id, io.input_pan_id as part_id
from ApidbTuning.${tblPrefix}PANIO io, ApidbTuning.${tblPrefix}Observations obs
where io.input_pan_id in (\$\$households_${tblPrefix}\$\$)
and io.output_pan_id in (\$\$visits_visitage_metadata_${tblPrefix}\$\$)
and obs.pan_id = io.output_pan_id
and obs.EUPATH_0000091 >= \$\$visit_date.min\$\$ 
and obs.EUPATH_0000091 <= \$\$visit_date.max\$\$ 
)
select distinct m.observation_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
 from ApidbTuning.${tblPrefix}ObservationMD m, valid
 where m.observation_id = valid.visit_id
/*
  union all
 select valid.visit_id as internal,  m.property_source_id as ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}MetaData m, valid, ApidbTuning.${tblPrefix}PANIO ios
where m.property_source_id = 'OBI_0100051'
and ios.output_pan_id = m.pan_id
and ios.input_pan_id = valid.visit_id
*/
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_${tblPrefix}" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<

[templateStart]
name=participantFilterParamsGEMS
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
       <filterParam name="geographic_region_gems" 
                       ontologyQueryRef="ParticipantVQ.GeographicRegionOntology_gems" 
                       metadataQueryRef="ParticipantVQ.GeographicRegionMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.GeographicRegionMetaDataBkg_gems"
                       filterDataTypeDisplayName="Participants"
                       prompt="Study Site"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.case_control,participantParams.study_arm">
         <help>
           Select participants based on their study site.
         </help>
       </filterParam>

       <filterParam name="household_gems" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_gems"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkg_gems"
                       filterDataTypeDisplayName="Household Observations"
                       prompt="Household"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.geographic_region_gems">
         <help>
           Select participants based on household characteristics. 
         </help>
       </filterParam>
       
       <filterParam name="participant_gems" 
                       ontologyQueryRef="ParticipantVQ.ParticipantOntology_gems"
                       metadataQueryRef="ParticipantVQ.ParticipantMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkg_gems"
                       filterDataTypeDisplayName="Participants"
                       prompt="Participant"
                       trimMetadataTerms="false"
                       countPredictsAnswerCount="true"
                       dependedParamRef="participantParams.household_gems">
         <help>
           Select participants based on their personal characteristics. 
         </help>
       </filterParam>

       <filterParam name="event_gems" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_gems"
                       metadataQueryRef="ParticipantVQ.ObservationMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_gems"
                       filterDataTypeDisplayName="Observations"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.participant_gems">
         <help>
           Select participants based on variables associated with their enrollment or followup events. 
         </help>
       </filterParam>       

      <filterParam name="relative_event_gems" 
                       ontologyQueryRef="ParticipantVQ.ObservationOntology_gems"
                       metadataQueryRef="ParticipantVQ.RelativeCasecontrolObservationMetaData_gems"
                       backgroundQueryRef="ParticipantVQ.ObservationMetaDataBkg_gems"
                       filterDataTypeDisplayName="Observations"
                       prompt="Related Case or Control"
                       trimMetadataTerms="true"
                       countPredictsAnswerCount="false"
                       dependedParamRef="participantParams.case_control">
         <help>
           Modify participants selected based on information about their related case or control. 
         </help>
       </filterParam>    
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesGEMS
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
    <sqlQuery name="GeographicRegionOntology_gems">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from apidbtuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('OBI_0001627')
     UNION
      select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision
from apidbtuning.${tblPrefix}Ontology o
     CONNECT BY o.ontology_term_source_id = PRIOR o.parent_ontology_term_source_id
     START WITH o.ontology_term_source_id in ('OBI_0001627')
          ]]>
      </sql>
    </sqlQuery>
    <sqlQuery name="GeographicRegionMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.case_control" />  
      <paramRef ref="participantParams.study_arm" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.ontology_term_name = 'OBI_0001627'
and m.household_id = hp.household_id 
and hp.participant_id in (select pan_id
       from ApidbTuning.${tblPrefix}Participants
       where lower(EUPATH_0010375) in (\$\$case_control\$\$))
and ('Both' = \$\$study_arm\$\$
       or hp.participant_id in (select participant_id
       from ApidbTuning.${tblPrefix}ParticipantMD
       where ontology_term_name = 'EUPATH_0015457'
       and lower(string_value) in (\$\$study_arm\$\$)))
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="GeographicRegionMetaDataBkg_gems" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.household_id as internal, hp.participant_id as record_id,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.ontology_term_name = 'OBI_0001627'
and m.household_id = hp.household_id  
          ]]>
    </sql>    
    </sqlQuery>
    
    <sqlQuery name="HouseholdOntology_gems">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in (${participantMultiFilterIdsQuoted}) AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'PCO_0000024'
)
where ontology_term_name not in (${participantFilterExcludedIdsQuoted})
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_gems" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                  select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where hp.household_id in (\$\$geographic_region_gems\$\$)
and m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkg_gems" isCacheable="false">
      <paramRef ref="participantParams.geographic_region_gems" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select hp.participant_id as internal,  m.household_observation_id as filter_item_id,
                  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}HouseholdMD m, ApidbTuning.${tblPrefix}HousePartIO hp
where m.household_id = hp.household_id 
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantOntology_gems">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0010425') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
) where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094','EUPATH_0010049','EUPATH_0010048','EUPATH_0010373','EUPATH_0000725','EUPATH_0010226')
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.household_gems" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
where m.participant_id in (\$\$household_gems\$\$)
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkg_gems" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select m.participant_id as internal,  m.ontology_term_name, m.string_value, m.number_value, m.date_value
from ApidbTuning.${tblPrefix}ParticipantMD m
         ]]>
      </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationOntology_gems">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.is_range,o.precision,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000321','EUPATH_0010011','EUPATH_0010351','EUPATH_0010357','EUPATH_0010378','EUPATH_0010379','EUPATH_0010380','EUPATH_0010383','EUPATH_0010389','EUPATH_0010390','EUPATH_0010391','EUPATH_0010393','EUPATH_0010394','EUPATH_0010395','EUPATH_0010040','NCBITaxon_10239','NCBITaxon_2','NCBITaxon_2759') AND o.type is null THEN 'multiFilter' ELSE o.type END as type, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
) where ontology_term_name not in ('OBI_0001616','EUPATH_0000094','EUPATH_0010049','EUPATH_0010048','EUPATH_0010373','EUPATH_0000725','EUPATH_0010226')
order by display_order, display_name
      </sql>
    </sqlQuery>

    <sqlQuery name="ObservationMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.participant_gems" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participant_gems\$\$)
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="ObservationMetaDataBkg_gems" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, sub_observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>    
    </sqlQuery>

    <sqlQuery name="RelativeCasecontrolObservationMetaData_gems" isCacheable="false">
      <paramRef ref="participantParams.case_control" />  
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, observation_id as filter_item_id, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (select pan_id
       from ApidbTuning.${tblPrefix}Participants
       where lower(EUPATH_0010375) not in (\$\$case_control\$\$) )
          ]]>
    </sql>    
    </sqlQuery>
>templateTextEnd<

[templateStart]
name=participantFilterParamsMALED
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
       <filterParam name="geographic_region_maled" 
                       metadataQueryRef="ParticipantVQ.RegionMetaData_maled"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_maled"
                       ontologyQueryRef="ParticipantVQ.RegionOntology_maled"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Participants"
                       prompt="Geographic region"
                       dependedParamRef=""
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_maled" 
                    ontologyQueryRef="ParticipantVQ.HouseholdOntology_maled"
                    metadataQueryRef="ParticipantVQ.HouseholdMetaData_maled"
                    backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_maled"
                    filterDataTypeDisplayName="Household Observations"
                    countPredictsAnswerCount="true"
                    prompt="Household Observations"
                    dependedParamRef="participantParams.geographic_region_maled"
                    trimMetadataTerms="true">
      <help>
        Select participants based on the characteristics of the household where they live. 
      </help>
    </filterParam>
 
       <filterParam name="participants_maled" 
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_maled"
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_maled"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_maled"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.households_maled">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_maled" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_maled"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_maled"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_maled"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.participants_maled">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesMALED
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
   <sqlQuery name="HouseholdOntology_maled" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
 select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, 
 nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000144') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('PCO_0000024')
     )
     where ontology_term_name not in ('EUPATH_0000095')
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448') 
     order by display_order, display_name 
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_maled" isCacheable="false">
     <paramRef ref="participantParams.geographic_region_maled" />  
     <column name="ontology_term_name"/>
     <column name="internal"/>
     <column name="filter_item_id"/>
     <column name="number_value"/>
     <column name="date_value"/>
     <column name="string_value"/>
     <sql>
       <![CDATA[
                select  hp.participant_id as internal, h.household_observation_id as filter_item_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
                where h.household_id in (\$\$geographic_region_maled\$\$)
                and h.household_id = hp.household_id 
       ]]>
     </sql>
   </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_maled" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
                select  hp.participant_id as internal, h.household_observation_id as filter_item_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
                from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
                where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_maled" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
 select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,o.type,o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id = 'EUPATH_0000096'
     )
     where ontology_term_name != 'EUPATH_0000095'
     order by display_order, display_name 
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_maled" isCacheable="false">
     <paramRef ref="participantParams.households_maled" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where participant_id in (\$\$households_maled\$\$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_maled" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_maled" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name, nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('NCBITaxon_2','NCBITaxon_2759','NCBITaxon_10239') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision,o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in  ('EUPATH_0000738','EUPATH_0000609')
     )
     where ontology_term_name not in ('EUPATH_0000091','OBI_0001616','EUPATH_0010859','EUPATH_0010860','EUPATH_0010861','EUPATH_0010857')
     order by display_order, display_name 
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_maled" isCacheable="false">
         <paramRef ref="participantParams.participants_maled" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_maled\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_maled" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="RegionOntology_maled" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
order by display_name
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_maled" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>
>templateTextEnd<

[templateStart]
name=participantFilterParamsINDIA
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
>templateTextStart<
       <filterParam name="geographic_region_india" 
                       ontologyQueryRef="ParticipantVQ.RegionOntology_india"
                       metadataQueryRef="ParticipantVQ.RegionMetaData_india"
                       backgroundQueryRef="ParticipantVQ.RegionMetaData_india"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Households"
                       prompt="Geographic region"
                       dependedParamRef=""
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

    <filterParam name="households_india" 
                       ontologyQueryRef="ParticipantVQ.HouseholdOntology_india"
                       metadataQueryRef="ParticipantVQ.HouseholdMetaData_india"
                       backgroundQueryRef="ParticipantVQ.HouseholdMetaDataBkgd_india"
                       countPredictsAnswerCount="true"
                       filterDataTypeDisplayName="Observations"
                       prompt="Households"
                       dependedParamRef="participantParams.geographic_region_india"
                       trimMetadataTerms="true">
         <help>
           Select participants based on their geographic region. 
         </help>
    </filterParam>

       <filterParam name="participants_india" 
                      ontologyQueryRef="ParticipantVQ.ParticipantOntology_india"
                      metadataQueryRef="ParticipantVQ.ParticipantMetaData_india"
                      backgroundQueryRef="ParticipantVQ.ParticipantMetaDataBkgd_india"
                      countPredictsAnswerCount="true"
                      filterDataTypeDisplayName="Participants"
                      prompt="Personal characteristics"
                      trimMetadataTerms="true"
                      dependedParamRef="participantParams.households_india">
         <help>
              Select participants based on their characteristics. 
         </help>
       </filterParam>

       <filterParam name="visits_india" 
                       metadataQueryRef="ParticipantVQ.VisitMetaData_india"
                       ontologyQueryRef="ParticipantVQ.VisitOntology_india"
                       backgroundQueryRef="ParticipantVQ.VisitMetaDataBkgd_india"
                       countPredictsAnswerCount="false"
                       prompt="Observations"
                       trimMetadataTerms="true"
                       dependedParamRef="participantParams.participants_india">
         <help>
           Select participants based on their visit characteristics. 
         </help>
       </filterParam>
>templateTextEnd<

[templateStart]
name=participantFilterParamQueriesINDIA
anchorFile=ClinEpiModel/Model/lib/dst/participantParams.dst
prop=tblPrefix
prop=householdMultiFilterIdsQuoted
prop=householdFilterExcludedIdsQuoted
prop=participantMultiFilterIdsQuoted
prop=participantFilterExcludedIdsQuoted
prop=observationMultiFilterIdsQuoted
prop=observationFilterExcludedIdsQuoted
prop=rmRegionSqlCommentStart
prop=rmRegionSqlCommentEnd
>templateTextStart<
   <sqlQuery name="RegionOntology_india" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
      <![CDATA[
select * from (
select o.ontology_term_source_id as ontology_term_name, cast(null as varchar2(1)) as parent_ontology_term_name, o.display_name, o.description, o.units,o.type,o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448' )
     where ontology_term_name not in ('GAZ_00000448')
         ]]>
    </sql>
   </sqlQuery>

    <sqlQuery name="RegionMetaData_india" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  distinct h.household_id as internal, hp.participant_id as record_id, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.ontology_term_name in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
and h.household_id = hp.household_id 
        ]]>
      </sql>
    </sqlQuery>

   <sqlQuery name="HouseholdOntology_india" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000001','EUPATH_0000003','EUPATH_0000343','EUPATH_0000441','EUPATH_0021093') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'PCO_0000024'
     )
     where ontology_term_name != 'EUPATH_0000094'
     and ontology_term_name not in (select ontology_term_source_id from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'GAZ_00000448')
     order by display_order, display_name
     ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="HouseholdMetaData_india" isCacheable="false">
     <paramRef ref="participantParams.geographic_region_india" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where hp.household_id in (\$\$geographic_region_india\$\$)
and h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="HouseholdMetaDataBkgd_india" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="filter_item_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  distinct h.household_observation_id as filter_item_id, hp.participant_id as internal, h.ontology_term_name, h.string_value, h.number_value, h.date_value
from ApidbTuning.${tblPrefix}HouseholdMD h, ApidbTuning.${tblPrefix}HousePartIO hp
where h.household_id = hp.household_id 
          ]]>
    </sql>
    </sqlQuery>

   <sqlQuery name="ParticipantOntology_india" isCacheable="true">
     <column name="ontology_term_name"/>
     <column name="parent_ontology_term_name"/>
     <column name="display_name"/>
     <column name="description"/>
     <column name="type"/>
     <column name="units"/>
     <column name="precision"/>
     <column name="is_range"/>
    <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name, o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000425','EUPATH_0000430','EUPATH_0000431','EUPATH_0000440','EUPATH_0000451') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range, o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id =  'EUPATH_0000096'
     )
     where ontology_term_name not in ('EUPATH_0000095','EUPATH_0000094')
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

   <sqlQuery name="ParticipantMetaData_india" isCacheable="false">
     <paramRef ref="participantParams.households_india" />  
     <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
where participant_id in (\$\$households_india\$\$)
          ]]>
    </sql>
    </sqlQuery>

    <sqlQuery name="ParticipantMetaDataBkgd_india" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
         <![CDATA[
select  participant_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ParticipantMD
          ]]>
    </sql>
    </sqlQuery>

    
    <sqlQuery name="VisitOntology_india" isCacheable="true">
      <column name="ontology_term_name"/>
      <column name="parent_ontology_term_name"/>
      <column name="display_name"/>
      <column name="description"/>
      <column name="type"/>
      <column name="units"/>
      <column name="precision"/>
      <column name="is_range"/>
      <sql>
         <![CDATA[
select * from (
select distinct o.ontology_term_source_id as ontology_term_name, o.parent_ontology_term_source_id as parent_ontology_term_name,
nvl(o.display_name,o.ontology_term_name) as display_name,o.description, o.units,
CASE WHEN o.ontology_term_source_id in ('EUPATH_0000344','EUPATH_0000413','EUPATH_0000439','EUPATH_0021002','EUPATH_0000423','EUPATH_0000433','EUPATH_0000437','EUPATH_0000438') AND o.type is null THEN 'multiFilter' ELSE o.type END as type,
o.is_range,o.precision, o.display_order
from ApidbTuning.${tblPrefix}Ontology o
     CONNECT BY o.parent_ontology_term_source_id = PRIOR o.ontology_term_source_id
     START WITH o.ontology_term_source_id in ('EUPATH_0000738','EUPATH_0000609')
     )
     order by display_order, display_name
         ]]>
    </sql>
   </sqlQuery>

       <sqlQuery name="VisitMetaData_india" isCacheable="false">
         <paramRef ref="participantParams.participants_india" />  
         <column name="ontology_term_name"/>
         <column name="internal"/>
         <column name="record_id"/>
         <column name="number_value"/>
         <column name="date_value"/>
         <column name="string_value"/>
         <sql>
           <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
where participant_id in (\$\$participants_india\$\$)
          ]]>
    </sql>
    </sqlQuery>    

    <sqlQuery name="VisitMetaDataBkgd_india" isCacheable="false">
      <column name="ontology_term_name"/>
      <column name="internal"/>
      <column name="record_id"/>
      <column name="number_value"/>
      <column name="date_value"/>
      <column name="string_value"/>
      <sql>
        <![CDATA[
select  participant_id as record_id, observation_id as internal, ontology_term_name, string_value, number_value, date_value
from ApidbTuning.${tblPrefix}ObservationMD
          ]]>
    </sql>
    </sqlQuery>
>templateTextEnd<

